---
title: "PatchSizePilot"
author: "Emanuele Giacomuzzo"
date: "2022-08-03"
output: 
  html_document:
    code_folding: hide
bibliography: library.bib
html_document:
    toc: true
    toc_float: true
    code_folding: hide
    number_sections: true
    includes:
      after_body: tabset-dropdown.html
editor_options: 
  chunk_output_type: console
---

```{r renv-seetings, eval = FALSE, echo = FALSE}

#Manage package versions using the package "renv". 

#renv::repair()
#renv::restore()
#renv::snapshot()
```

```{r set-up-environment, echo = FALSE}

#Set up the environment. 

knitr::opts_chunk$set(message = FALSE, cache=TRUE)
rm( list = ls(  ) )
cat( "\014" )
start_time = Sys.time()
recompute_analyses = FALSE #Lengthy analyses have been suppressed. Set recompute_analyses = TRUE to redo them. 
compute_n_display_datasets = FALSE
```

```{r packages, echo = FALSE, results = FALSE, message = FALSE, cache = FALSE}

#Packages & conflicts

library("conflicted")
library("tidyverse")
library("grid")
library("gridExtra") 
library("lme4")
library("here")
library("MuMIn")
library("equatiomatic")
library("knitr")
library("optimx")
library("GenSA")
library("purrr")
library("kableExtra")
library("DT")
library("renv")
library("broom")
library("patchwork")
library("gganimate") 
library("gapminder")
library("gifski")
library("av")
library("transformr")
library("gifski")
library("GGally")
#library("strengejacke")
library("sjPlot")
library("sjstats")
library("partR2")
library("SciViews")
library("effsize")
library("boot")
library("vegan")
library("betapart")
library("caret")
library("leaps")
library("MASS")
library("glmulti")
library("metafor")

conflict_prefer("load", "base")
conflict_prefer("filter", "dplyr")
conflict_prefer("select", "dplyr")
```

```{r include = FALSE}

#Import data sets (useful to avoid knitting/going through every child when working in rmd). 

culture_info = read.csv(here("data", "PatchSizePilot_culture_info.csv"), header = TRUE)
ds_patches = readRDS(here("results", "ds_patches.RData"))
ds_patches_effect_size = readRDS(here("results", "ds_patches_effect_size.RData"))
ds_metaecosystems = readRDS(here("results", "ds_metaecosystems.RData"))
ds_individuals = readRDS(here("results", "ds_individuals.RData"))
ds_classes = readRDS(here("results", "ds_classes.RData"))
ds_classes_effect_size = readRDS(here("results", "ds_classes_effect_size.RData"))
ds_median_body_size = readRDS(here("results", "ds_median_body_size.RData"))
ds_lnRR_median_body_size = readRDS(here("results", "ds_lnRR_median_body_size.RData"))
```

```{r functions, echo = FALSE}

#Import functions. 

source(here("r_files", "functions", "calculate.hedges_d.R"))
```

```{r various-parameters, echo = FALSE}

#Give experiment parameters. 

nr_videos = c(12,1,1,1,1,1,2,2)
first_time_point = 0
last_time_point = 7
n_time_points = 8

first_perturbation_day = 5
resource_flow_days = c(5, 9, 13, 17, 21, 25)
sampling_days = c(0, 4, 8, 12, 16, 20, 24, 28)

system_nr_metaecosystems = 16:70
ecosystems_to_take_off = 60 #Culture ID = 60 because it was spilled (isolated small patch, high disturbance, system nr = 40)
metaecosystems_to_take_off = 40 #System 40 was the system of culture 60 that I spilled
protist_species = c("Ble", "Cep", "Col", "Eug", "Eup", "Lox", "Pau", "Pca", "Spi", "Spi_te", "Tet")
n_protist_species = length(protist_species)
n_metaecosystems = 55
n_cultures = 110
culture_info = read.csv(here("data", "PatchSizePilot_culture_info.csv"), header = TRUE); eco_metaeco_types = unique(culture_info$eco_metaeco_type)

first_time_point_model = 2
last_time_point_model = 7
disturbance_input = "low"

include_non_clean_scripts = FALSE
```

```{r echo = FALSE}

#Handle figures. 

include_GIFS = FALSE

publication_width = 12
publication_height = 12
publication_unit = "cm"
presentation_size = 20
```


```{r echo = FALSE}

#Choose colours. 

colour_isolated = "#d9cbbe"
colour_different_size = "#4992c6"
colour_same_size = "#bc9960"
colour_small = "#ffff00"
colour_medium = "#ff9933"
colour_large = "#ff0000"
colour_MM = "#dd7f42" #Colour of the Medium-Medium meta-ecosystem
colour_SL = "#438cbe" #Colour of the Small-Large meta-ecosystem 
```


# {.tabset}

## Overview {.tabset .tabset-pills}

```{r overview-experiment, child = here("r_files", "overview.Rmd"), eval = compute_n_display_datasets}
```

## Data {.tabset .tabset-dropdown}

```{r child = here("r_files", "data_culture_info.Rmd"), eval = compute_n_display_datasets}
```

```{r child = here("r_files", "data_patches.Rmd"), eval = compute_n_display_datasets}
```

```{r child = here("r_files", "data_patches_effect_size.Rmd"), eval = compute_n_display_datasets}
```

```{r child = here("r_files", "data_metaecosystems.Rmd"), eval = compute_n_display_datasets}
```

```{r child = here("r_files", "data_individuals.Rmd"), eval = compute_n_display_datasets}
```

```{r child = here("r_files", "data_classes.Rmd"), eval = compute_n_display_datasets}
```

```{r child = here("r_files", "data_classes_effect_size.Rmd"), eval = compute_n_display_datasets}
```

## Meta-ecosystems {.tabset .tabset-dropdown}

### All

```{r child = here("r_files", "biomass_metaeco_all.Rmd"), eval = include_non_clean_scripts}
```

### Equally sized {.tabset .tabset-pills}

```{r child = here("r_files", "biomass_metaeco_equally_sized.Rmd"), eval = include_non_clean_scripts}
```

```{r child = here("r_files", "beta_diversity_metaeco_equally_sized.Rmd"), eval = include_non_clean_scripts}
```

```{r child = here("r_files", "gamma_diversity_metaeco_equally_sized.Rmd"), eval = include_non_clean_scripts}
```

```{r child = here("r_files", "gamma_diversity_metaeco_equally_sized.Rmd"), eval = include_non_clean_scripts}
```


### MM vs SL {.tabset .tabset-pills}

```{r child = here("r_files", "biomass_metaeco_MM_SL.Rmd"), eval = include_non_clean_scripts}
```

```{r child = here("r_files", "beta_diversity_metaeco_MM_SL.Rmd"), eval = include_non_clean_scripts}
```

```{r child = here("r_files", "gamma_diversity_metaeco_MM_SL.Rmd"), eval = include_non_clean_scripts}
```

### SL vs SL* {.tabset .tabset-pills}

```{r child = here("r_files", "biomass_metaeco_SL_SL_from_isolated.Rmd"), eval = include_non_clean_scripts}
```

## Patches {.tabset .tabset-dropdown}

### All  {.tabset .tabset-pills}

```{r child = here("r_files", "biomass_patches_all.Rmd"), eval = include_non_clean_scripts}
```

### Isolated  {.tabset .tabset-pills}

```{r child = here("r_files", "comm_abundance_patches_isolated.Rmd"), eval = include_non_clean_scripts}
```

```{r child = here("r_files", "biomass_patches_isolated.Rmd"), eval = include_non_clean_scripts}
```

```{r child = here("r_files", "population_abundances_patches_isolated.Rmd"), eval = include_non_clean_scripts}
```

```{r child = here("r_files", "alpha_diversity_patches_isolated.Rmd")}
```

```{r child = here("r_files", "body_size_distribution_patches_isolated.Rmd"), eval = include_non_clean_scripts}
```


### Small {.tabset .tabset-pills}

```{r child = here("r_files", "biomass_patches_small.Rmd"), eval = include_non_clean_scripts}
```

```{r child = here("r_files", "comm_abundance_patches_small.Rmd"), eval = include_non_clean_scripts}
```

```{r child = here("r_files", "population_abundances_patches_small.Rmd"), eval = include_non_clean_scripts}
```

```{r child = here("r_files", "alpha_diversity_patches_small.Rmd")}
```

```{r child = here("r_files", "body_size_distribution_patches_small.Rmd"), eval = include_non_clean_scripts}
```

### Large {.tabset .tabset-pills}

```{r child = here("r_files", "biomass_patches_large.Rmd"), eval = include_non_clean_scripts}
```

```{r child = here("r_files", "comm_abundance_patches_large.Rmd"), eval = include_non_clean_scripts}
```

```{r child = here("r_files", "population_abundances_patches_large.Rmd"), eval = include_non_clean_scripts}
```

```{r child = here("r_files", "alpha_diversity_patches_large.Rmd")}
```

```{r child = here("r_files", "body_size_distribution_patches_large.Rmd"), eval = include_non_clean_scripts}
```

## Evaporation {.tabset .tabset-pills}

```{r child = here("r_files", "evaporation.Rmd")}
```

```{r child = here("r_files", "evaporation_tests.Rmd")}
```

## Video analysis script

```{r child = here("r_files", "video_analysis_script.Rmd")}
```

```{r child = here("r_files", "parameterisation.Rmd")}
```

## Running time

```{r running-time, echo = FALSE, eval = TRUE}
end_time = Sys.time()
end_time - start_time
```

## Bibliography

