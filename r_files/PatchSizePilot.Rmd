---
title: "PatchSizePilot"
author: "Emanuele Giacomuzzo"
date: "2022-08-03"
output: 
  html_document:
     code_folding: hide
bibliography: /Applications/Mendeley/library.bib
html_document:
    toc: true
    toc_float: true
    code_folding: hide
    number_sections: true
    includes:
      after_body: tabset-dropdown.html
editor_options: 
  chunk_output_type: console
---

```{r extract-sections, echo = FALSE, eval = FALSE}
library(here)
library(knitr)
library(purrr)

list_of_main_sections = c("abundance", "biomass_local", "biomass_regional", "body_size_distribution", "body_size_median", "data", "evaporation", "tests")

for (main_section in list_of_main_sections){
  
 sections.path = here("r_files", main_section, "sections")
 extracted.path = here("r_files", main_section, "extracted_sections")
 
 r.files = list.files(sections.path)
 rmd.files = r.files[grepl(".Rmd", r.files)]
 
 map(rmd.files, function(file.i) {
   
   file.name = gsub(".Rmd", "", file.i)
   extracted.file = paste0(file.name, ".R")
   purl(file.path(sections.path, file.i),
        file.path(extracted.path, extracted.file))}) 
}
```

```{r eval = FALSE, echo = FALSE}
renv::repair()
renv::snapshot()
```

```{r set-up-environment, echo = FALSE}
knitr::opts_chunk$set(message = FALSE)
rm( list = ls(  ) )
cat( "\014" )
start_time = Sys.time()
```

```{r packages, echo = FALSE, results = FALSE, message = FALSE}
library("conflicted")
library("tidyverse")
library("grid")
library("gridExtra") 
library("lme4")
library("here")
library("MuMIn")
library("equatiomatic")
library("knitr")
library("optimx")
library("GenSA")
library("purrr")
library("kableExtra")
library("DT")
library("renv")
library("broom")
library("patchwork")
library("gganimate") 
library("gapminder")
library("gifski")
library("av")
library("transformr")
library("gifski")
library("GGally")
library("strengejacke")
library("sjPlot")
library("sjstats")
library("partR2")
library("SciViews")
library("effsize")
library("boot")

conflict_prefer("load", "base")
conflict_prefer("filter", "dplyr")
```

```{r various-parameters, echo = FALSE}
gif_figures = TRUE

publication_width = 12
publication_height = 12
publication_unit = "cm"

n_time_points = 8
first_perturbation_day = 5
ecosystems_to_take_off = 60 #Culture ID = 60 because it was spilled (isolated small patch, high disturbance, system nr = 40)
metaecosystems_to_take_off = 40 #System 40 was the system of culture 60 that I spilled
```

# PatchSizePilot {.tabset}

```{r child = here("r_files", "overview.Rmd")}
```

```{r child = here("r_files", "data", "main_data.Rmd")}
source(here("r_files", "data", "extracted_sections", "experimental_treatments.R"))
source(here("r_files", "data", "extracted_sections", "biomass_abundance_data.R"))
source(here("r_files", "data", "extracted_sections", "body_size_data.R"))
```

```{r child = here("r_files", "biomass_regional", "main_biomass_regional.Rmd")}
```

```{r child = here("r_files", "biomass_local", "main_biomass_local.Rmd")}
```

```{r child = here("r_files", "abundance", "main_abundance.Rmd")}
```

```{r child = here("r_files", "body_size_distribution", "main_body_size_distribution.Rmd")}
```

```{r child = here("r_files", "body_size_median", "main_body_size_median.Rmd")}
```

```{r child = here("r_files", "evaporation", "sections", "evaporation.Rmd")}
```

## Figures

```{r, echo = FALSE, fig.align='center', fig.cap = "Regional biomass under low disturbance in meta-ecosystems of the same total area, but exhibiting two local patches of the same size (red, medium-medium meta-ecosystem) or different size (blue, small-large meta-ecosystem). Points represent the mean, error bars represent the standard deviation. See the Appendix for equivalent figure of the high disturbance treatment.", eval = FALSE}
regional_publication + labs(title = "")

ggsave(here("results", "biomass", "regional_publication.jpg"), 
       regional_publication + labs(title = ""), 
       units = publication_unit,
       width = publication_width, 
       height = publication_height)
```

```{r, echo = FALSE, fig.align = 'center', fig.cap = "Local biomass under low disturbance in patches connected to a patch of the same size (red, small patches of small-small meta-ecosystems) or to a patch of larger size (blue, small patches of small-large meta-ecosystems). The local biomass has been transformed as the natural logarithm of the reponse ratio as follows: ln(RR) = ln((bioarea + 1) / mean bioarea small isolated patches under low disturbance).", eval = FALSE}
small_patches_publication + labs(title = "")

ggsave(here("results", "biomass", "small_patches_publication.jpg"), 
       small_patches_publication + labs(title = ""), 
       units = publication_unit,
       width = publication_width, 
       height = publication_height)
```

```{r child = here("r_files", "tests", "main_tests.Rmd")}
```

## Running time

```{r running-time, echo = FALSE, eval = TRUE}
end_time = Sys.time()
end_time - start_time
```

## Bibliography