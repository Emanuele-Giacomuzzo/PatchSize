---
title: "Data Regional Biomass"
output: html_document
date: "2022-11-22"
editor_options: 
  chunk_output_type: console
---

-   Each row is a meta-ecosystem.

-   It contains also "fake" meta-ecosystems which I created from isolated patches (`metaecosystem type = Small-Large isolated` & `metaecosystem type = Medium-Medium isolated`).

```{r}
### Create a data frame with all the experimental meta-ecosystems and all the possible meta-ecosystems from isolated
culture_ID_isolated_S_low = ds_patches %>%
  filter(patch_type == "Small isolated",
         disturbance == "low") %>%
  pull(culture_ID) %>%
  unique()

culture_ID_isolated_L_low = ds_patches %>%
  filter(patch_type == "Large isolated",
         disturbance == "low") %>%
  pull(culture_ID) %>%
  unique()

culture_ID_isolated_S_high = ds_patches %>%
  filter(patch_type == "Small isolated",
         disturbance == "high") %>%
  pull(culture_ID) %>%
  unique()

culture_ID_isolated_L_high = ds_patches %>%
  filter(patch_type == "Large isolated",
         disturbance == "high") %>%
  pull(culture_ID) %>%
  unique()

culture_ID_isolated_M_low = ds_patches %>%
  filter(patch_type == "Medium isolated",
         disturbance == "low") %>%
  pull(culture_ID) %>%
  unique()

culture_ID_isolated_M_high = ds_patches %>%
  filter(patch_type == "Medium isolated",
         disturbance == "high") %>%
  pull(culture_ID) %>%
  unique()

combinations_S_and_L_low = crossing(culture_ID_isolated_S_low,
                                    culture_ID_isolated_L_low) %>%
                            mutate(disturbance = "low",
                                   metaecosystem_type = "Small-Large isolated") %>%
                            rename(ID_first_patch = culture_ID_isolated_S_low,
                                   ID_second_patch = culture_ID_isolated_L_low)

combinations_S_and_L_high = crossing(culture_ID_isolated_S_high,
                                    culture_ID_isolated_L_high) %>%
                            mutate(disturbance = "high",
                                   metaecosystem_type = "Small-Large isolated") %>%
                            rename(ID_first_patch = culture_ID_isolated_S_high,
                                   ID_second_patch = culture_ID_isolated_L_high)

combinations_M_and_M_low = combn(unique(culture_ID_isolated_M_low,
                                        culture_ID_isolated_M_low),
                                 m = 2) %>%
                            t() %>%
                            as.data.frame() %>%
                            mutate(disturbance = "low",
                                   metaecosystem_type = "Medium-Medium isolated") %>%
                            rename(ID_first_patch = V1,
                                   ID_second_patch = V2)

combinations_M_and_M_high = combn(unique(culture_ID_isolated_M_high,
                                         culture_ID_isolated_M_high),
                                  m = 2) %>%
                            t() %>%
                            as.data.frame() %>%
                            mutate(disturbance = "high",
                                   metaecosystem_type = "Medium-Medium isolated") %>%
                            rename(ID_first_patch = V1,
                                   ID_second_patch = V2)

ID_combinations_isolated = rbind(
  combinations_S_and_L_low,
  combinations_S_and_L_high,
  combinations_M_and_M_low,
  combinations_M_and_M_high
) 

ID_combinations_isolated = ID_combinations_isolated %>%
  mutate(system_nr = 1001:(1000 + nrow(ID_combinations_isolated)))

ID_combinations_metaecos = read.csv(here("data", "ID_combinations_metaecos.csv"))

ID_combinations = rbind(ID_combinations_isolated,
                         ID_combinations_metaecos)

number_of_combinations = nrow(ID_combinations)
```

```{r}
ds_metaecosystems = create.meatecosystem.ds()
```

```{r}
#Add whether systems are connected or not 
ds_metaecosystems$connection <-
  ifelse(
    ds_metaecosystems$metaecosystem_type %in% c("Medium-Medium isolated",
                                                "Small-Large isolated"),
    yes = "isolated",
    no = "connected"
  )

#Add whether patch sizes are symmetric or not
ds_metaecosystems$patch_size_symmetry <-
  ifelse(
    ds_metaecosystems$metaecosystem_type %in% c("Small-Large isolated",
                                                "Small-Large meta-ecosystem"),
    yes = "asymmetric",
    no = "symmetric"
  )
```

```{r add-baselines-(ds_metaecosystems)}
#Add baselines (from t1).
baselines <- ds_metaecosystems %>%
  ungroup() %>%
  filter(time_point == 1) %>%
  group_by(system_nr) %>%
  summarise(across(variables_metaecos, .names = "baseline_{.col}"))

ds_metaecosystems = full_join(ds_metaecosystems, baselines)
```