---
title: "Population abundances in small patches"
author: "Emanuele Giacomuzzo"
date: "2022-10-17"
output: html_document
editor_options: 
  chunk_output_type: console
---

### Small patches {.tabset .tabset-pills}

```{r}
patch_size_input = "S"
```

#### Low disturbance {.tabset}

```{r}
disturbance_input = "low"
```

##### Ble

```{r}
ds_patches %>%
      filter(
        disturbance == disturbance_input,
        patch_size == patch_size_input
      ) %>%
      ggplot(
        aes(
          x = day,
          y = Ble,
          group = interaction(day, eco_metaeco_type),
          fill = eco_metaeco_type
        )
      ) +
      geom_boxplot() +
      labs(
        x = "Day",
        y = "Ble Density (indiv/μl ?)",
        fill = "",
        caption = "Vertical grey line: resource flow"
      ) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      scale_fill_manual(
        values = c(colour_isolated, colour_different_size, colour_same_size),
        labels = c(
          "Small isolated",
          "Small connected to large",
          "Small connected to small"
        )
      )  +
      scale_x_continuous(breaks = unique(ds_patches$day)) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      )
```

```{r}
ds_patches_effect_size %>%
      filter(disturbance == disturbance_input,
             eco_metaeco_type %in% c("S (S_L)", "S (S_S)"),
             day > 0) %>%
      ggplot(aes(
        x = day,
        y = Ble_d,
        color = eco_metaeco_type
      )) +
      geom_point(position = position_dodge(0.5)) +
      geom_line(position = position_dodge(0.5)) +
      geom_errorbar(
        aes(ymin = Ble_d_lower,
            ymax = Ble_d_upper),
        width = .2,
        position = position_dodge(0.5)
      ) +
      labs(
        title = paste("Disturbance =", disturbance_input),
        x = "Day",
        y = "Ble Density Effect Size (Hedge's d)",
        color = ""
      ) +
       scale_color_discrete(
         labels = c("Small connected to large",
                    "Small connnected to small")
       ) +
      scale_x_continuous(breaks = unique(ds_patches_effect_size$day)) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_hline(
        yintercept = 0,
        linetype = "dotted",
        color = "black",
        size = 0.7
      )
```

```{r}

#Filter data

filtered_data = ds_patches_effect_size %>%
  filter(patch_size == patch_size_input,
         disturbance == disturbance_input,
         time_point >= first_time_point_model,
         time_point <= last_time_point_model)

#Test hp 

full_model = lm(Ble_d ~                  
                  day + 
                  eco_metaeco_type + 
                  day : eco_metaeco_type,
                  data = filtered_data)

null_model = lm(Ble_d ~                  
                  day,
                  data = filtered_data)

AIC(full_model, null_model)

anova = anova(full_model, null_model)
anova

p_value = anova$`Pr(>F)`[2]
p_value = round(p_value, digits = 3)
p_value

#Model diagnostics

par(mfrow = c(2,3))
plot(full_model, which = 1:5)

#Model statistics

R2_full = glance(full_model)$r.squared
R2_null = glance(null_model)$r.squared
R2_P = R2_full - R2_null

R2_full = round(R2_full, digits = 2)
R2_P = round(R2_P, digits = 2)
```

-   p value of patch type: `r p_value`

-   R2 of patch type: `r R2_P`

##### Cep

```{r}
ds_patches %>%
      filter(
        disturbance == disturbance_input,
        patch_size == patch_size_input
      ) %>%
      ggplot(
        aes(
          x = day,
          y = Cep,
          group = interaction(day, eco_metaeco_type),
          fill = eco_metaeco_type
        )
      ) +
      geom_boxplot() +
      labs(
        x = "Day",
        y = "Cep Density (indiv/μl ?)",
        fill = "",
        caption = "Vertical grey line: resource flow"
      ) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      scale_fill_manual(
        values = c(colour_isolated, colour_different_size, colour_same_size),
        labels = c(
          "Small isolated",
          "Small connected to large",
          "Small connected to small"
        )
      )  +
      scale_x_continuous(breaks = unique(ds_patches$day)) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      )
```

```{r}
ds_patches_effect_size %>%
      filter(disturbance == disturbance_input,
             eco_metaeco_type %in% c("S (S_L)", "S (S_S)"),
             day > 0) %>%
      ggplot(aes(
        x = day,
        y = Cep_d,
        color = eco_metaeco_type
      )) +
      geom_point(position = position_dodge(0.5)) +
      geom_line(position = position_dodge(0.5)) +
      geom_errorbar(
        aes(ymin = Cep_d_lower,
            ymax = Cep_d_upper),
        width = .2,
        position = position_dodge(0.5)
      ) +
      labs(
        title = paste("Disturbance =", disturbance_input),
        x = "Day",
        y = "Cep Density Effect Size (Hedge's d)",
        color = ""
      ) +
       scale_color_discrete(
         labels = c("Small connected to large",
                    "Small connnected to small")
       ) +
      scale_x_continuous(breaks = unique(ds_patches_effect_size$day)) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_hline(
        yintercept = 0,
        linetype = "dotted",
        color = "black",
        size = 0.7
      )
```

```{r}

#Filter data

filtered_data = ds_patches_effect_size %>%
  filter(patch_size == patch_size_input,
         disturbance == disturbance_input,
         time_point >= first_time_point_model,
         time_point <= last_time_point_model)

#Test hp 

full_model = lm(Cep_d ~                  
                  day + 
                  eco_metaeco_type + 
                  day : eco_metaeco_type,
                  data = filtered_data)

null_model = lm(Cep_d ~                  
                  day,
                  data = filtered_data)

AIC(full_model, null_model)

anova = anova(full_model, null_model)
anova

p_value = anova$`Pr(>F)`[2]
p_value = round(p_value, digits = 3)
p_value

#Model diagnostics

par(mfrow = c(2,3))
plot(full_model, which = 1:5)

#Model statistics

R2_full = glance(full_model)$r.squared
R2_null = glance(null_model)$r.squared
R2_P = R2_full - R2_null

R2_full = round(R2_full, digits = 2)
R2_P = round(R2_P, digits = 2)
```

-   p value of patch type: `r p_value`

-   R2 of patch type: `r R2_P`

##### Col

```{r}
ds_patches %>%
      filter(
        disturbance == disturbance_input,
        patch_size == patch_size_input
      ) %>%
      ggplot(
        aes(
          x = day,
          y = Col,
          group = interaction(day, eco_metaeco_type),
          fill = eco_metaeco_type
        )
      ) +
      geom_boxplot() +
      labs(
        x = "Day",
        y = "Col Density (indiv/μl ?)",
        fill = "",
        caption = "Vertical grey line: resource flow"
      ) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      scale_fill_manual(
        values = c(colour_isolated, colour_different_size, colour_same_size),
        labels = c(
          "Small isolated",
          "Small connected to large",
          "Small connected to small"
        )
      )  +
      scale_x_continuous(breaks = unique(ds_patches$day)) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      )
```

```{r}
ds_patches_effect_size %>%
      filter(disturbance == disturbance_input,
             eco_metaeco_type %in% c("S (S_L)", "S (S_S)"),
             day > 0) %>%
      ggplot(aes(
        x = day,
        y = Col_d,
        color = eco_metaeco_type
      )) +
      geom_point(position = position_dodge(0.5)) +
      geom_line(position = position_dodge(0.5)) +
      geom_errorbar(
        aes(ymin = Col_d_lower,
            ymax = Col_d_upper),
        width = .2,
        position = position_dodge(0.5)
      ) +
      labs(
        title = paste("Disturbance =", disturbance_input),
        x = "Day",
        y = "Col Density Effect Size (Hedge's d)",
        color = ""
      ) +
       scale_color_discrete(
         labels = c("Small connected to large",
                    "Small connnected to small")
       ) +
      scale_x_continuous(breaks = unique(ds_patches_effect_size$day)) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_hline(
        yintercept = 0,
        linetype = "dotted",
        color = "black",
        size = 0.7
      )
```

```{r}

#Filter data

filtered_data = ds_patches_effect_size %>%
  filter(patch_size == patch_size_input,
         disturbance == disturbance_input,
         time_point >= first_time_point_model,
         time_point <= last_time_point_model)

#Test hp 

full_model = lm(Col_d ~                  
                  day + 
                  eco_metaeco_type + 
                  day : eco_metaeco_type,
                  data = filtered_data)

null_model = lm(Col_d ~                  
                  day,
                  data = filtered_data)

AIC(full_model, null_model)

anova = anova(full_model, null_model)
anova

p_value = anova$`Pr(>F)`[2]
p_value = round(p_value, digits = 3)
p_value

#Model diagnostics

par(mfrow = c(2,3))
plot(full_model, which = 1:5)

#Model statistics

R2_full = glance(full_model)$r.squared
R2_null = glance(null_model)$r.squared
R2_P = R2_full - R2_null

R2_full = round(R2_full, digits = 2)
R2_P = round(R2_P, digits = 2)
```

-   p value of patch type: `r p_value`

-   R2 of patch type: `r R2_P`

##### Eug

```{r}
ds_patches %>%
      filter(
        disturbance == disturbance_input,
        patch_size == patch_size_input
      ) %>%
      ggplot(
        aes(
          x = day,
          y = Eug,
          group = interaction(day, eco_metaeco_type),
          fill = eco_metaeco_type
        )
      ) +
      geom_boxplot() +
      labs(
        x = "Day",
        y = "Eug Density (indiv/μl ?)",
        fill = "",
        caption = "Vertical grey line: resource flow"
      ) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      scale_fill_manual(
        values = c(colour_isolated, colour_different_size, colour_same_size),
        labels = c(
          "Small isolated",
          "Small connected to large",
          "Small connected to small"
        )
      )  +
      scale_x_continuous(breaks = unique(ds_patches$day)) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      )
```

```{r}
ds_patches_effect_size %>%
      filter(disturbance == disturbance_input,
             eco_metaeco_type %in% c("S (S_L)", "S (S_S)"),
             day > 0) %>%
      ggplot(aes(
        x = day,
        y = Eug_d,
        color = eco_metaeco_type
      )) +
      geom_point(position = position_dodge(0.5)) +
      geom_line(position = position_dodge(0.5)) +
      geom_errorbar(
        aes(ymin = Eug_d_lower,
            ymax = Eug_d_upper),
        width = .2,
        position = position_dodge(0.5)
      ) +
      labs(
        title = paste("Disturbance =", disturbance_input),
        x = "Day",
        y = "Eug Density Effect Size (Hedge's d)",
        color = ""
      ) +
       scale_color_discrete(
         labels = c("Small connected to large",
                    "Small connnected to small")
       ) +
      scale_x_continuous(breaks = unique(ds_patches_effect_size$day)) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_hline(
        yintercept = 0,
        linetype = "dotted",
        color = "black",
        size = 0.7
      )
```

```{r}

#Filter data

filtered_data = ds_patches_effect_size %>%
  filter(patch_size == patch_size_input,
         disturbance == disturbance_input,
         time_point >= first_time_point_model,
         time_point <= last_time_point_model)

#Test hp 

full_model = lm(Eug_d ~                  
                  day + 
                  eco_metaeco_type + 
                  day : eco_metaeco_type,
                  data = filtered_data)

null_model = lm(Eug_d ~                  
                  day,
                  data = filtered_data)

AIC(full_model, null_model)

anova = anova(full_model, null_model)
anova

p_value = anova$`Pr(>F)`[2]
p_value = round(p_value, digits = 3)
p_value

#Model diagnostics

par(mfrow = c(2,3))
plot(full_model, which = 1:5)

#Model statistics

R2_full = glance(full_model)$r.squared
R2_null = glance(null_model)$r.squared
R2_P = R2_full - R2_null

R2_full = round(R2_full, digits = 2)
R2_P = round(R2_P, digits = 2)
```

-   p value of patch type: `r p_value`

-   R2 of patch type: `r R2_P`

##### Eup

```{r}
ds_patches %>%
      filter(
        disturbance == disturbance_input,
        patch_size == patch_size_input
      ) %>%
      ggplot(
        aes(
          x = day,
          y = Eup,
          group = interaction(day, eco_metaeco_type),
          fill = eco_metaeco_type
        )
      ) +
      geom_boxplot() +
      labs(
        x = "Day",
        y = "Eup Density (indiv/μl ?)",
        fill = "",
        caption = "Vertical grey line: resource flow"
      ) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      scale_fill_manual(
        values = c(colour_isolated, colour_different_size, colour_same_size),
        labels = c(
          "Small isolated",
          "Small connected to large",
          "Small connected to small"
        )
      )  +
      scale_x_continuous(breaks = unique(ds_patches$day)) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      )
```

```{r}
ds_patches_effect_size %>%
      filter(disturbance == disturbance_input,
             eco_metaeco_type %in% c("S (S_L)", "S (S_S)"),
             day > 0) %>%
      ggplot(aes(
        x = day,
        y = Eup_d,
        color = eco_metaeco_type
      )) +
      geom_point(position = position_dodge(0.5)) +
      geom_line(position = position_dodge(0.5)) +
      geom_errorbar(
        aes(ymin = Eup_d_lower,
            ymax = Eup_d_upper),
        width = .2,
        position = position_dodge(0.5)
      ) +
      labs(
        title = paste("Disturbance =", disturbance_input),
        x = "Day",
        y = "Eup Density Effect Size (Hedge's d)",
        color = ""
      ) +
       scale_color_discrete(
         labels = c("Small connected to large",
                    "Small connnected to small")
       ) +
      scale_x_continuous(breaks = unique(ds_patches_effect_size$day)) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_hline(
        yintercept = 0,
        linetype = "dotted",
        color = "black",
        size = 0.7
      )
```

```{r}

#Filter data

filtered_data = ds_patches_effect_size %>%
  filter(patch_size == patch_size_input,
         disturbance == disturbance_input,
         time_point >= first_time_point_model,
         time_point <= last_time_point_model)

#Test hp 

full_model = lm(Eup_d ~                  
                  day + 
                  eco_metaeco_type + 
                  day : eco_metaeco_type,
                  data = filtered_data)

null_model = lm(Eup_d ~                  
                  day,
                  data = filtered_data)

AIC(full_model, null_model)

anova = anova(full_model, null_model)
anova

p_value = anova$`Pr(>F)`[2]
p_value = round(p_value, digits = 3)
p_value

#Model diagnostics

par(mfrow = c(2,3))
plot(full_model, which = 1:5)

#Model statistics

R2_full = glance(full_model)$r.squared
R2_null = glance(null_model)$r.squared
R2_P = R2_full - R2_null

R2_full = round(R2_full, digits = 2)
R2_P = round(R2_P, digits = 2)
```

-   p value of patch type: `r p_value`

-   R2 of patch type: `r R2_P`

##### Lox

```{r}
ds_patches %>%
      filter(
        disturbance == disturbance_input,
        patch_size == patch_size_input
      ) %>%
      ggplot(
        aes(
          x = day,
          y = Lox,
          group = interaction(day, eco_metaeco_type),
          fill = eco_metaeco_type
        )
      ) +
      geom_boxplot() +
      labs(
        x = "Day",
        y = "Lox Density (indiv/μl ?)",
        fill = "",
        caption = "Vertical grey line: resource flow"
      ) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      scale_fill_manual(
        values = c(colour_isolated, colour_different_size, colour_same_size),
        labels = c(
          "Small isolated",
          "Small connected to large",
          "Small connected to small"
        )
      )  +
      scale_x_continuous(breaks = unique(ds_patches$day)) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      )
```

```{r}
ds_patches_effect_size %>%
      filter(disturbance == disturbance_input,
             eco_metaeco_type %in% c("S (S_L)", "S (S_S)"),
             day > 0) %>%
      ggplot(aes(
        x = day,
        y = Lox_d,
        color = eco_metaeco_type
      )) +
      geom_point(position = position_dodge(0.5)) +
      geom_line(position = position_dodge(0.5)) +
      geom_errorbar(
        aes(ymin = Lox_d_lower,
            ymax = Lox_d_upper),
        width = .2,
        position = position_dodge(0.5)
      ) +
      labs(
        title = paste("Disturbance =", disturbance_input),
        x = "Day",
        y = "Lox Density Effect Size (Hedge's d)",
        color = ""
      ) +
       scale_color_discrete(
         labels = c("Small connected to large",
                    "Small connnected to small")
       ) +
      scale_x_continuous(breaks = unique(ds_patches_effect_size$day)) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_hline(
        yintercept = 0,
        linetype = "dotted",
        color = "black",
        size = 0.7
      )
```

```{r}

#Filter data

filtered_data = ds_patches_effect_size %>%
  filter(patch_size == patch_size_input,
         disturbance == disturbance_input,
         time_point >= first_time_point_model,
         time_point <= last_time_point_model)

#Test hp 

full_model = lm(Lox_d ~                  
                  day + 
                  eco_metaeco_type + 
                  day : eco_metaeco_type,
                  data = filtered_data)

null_model = lm(Lox_d ~                  
                  day,
                  data = filtered_data)

AIC(full_model, null_model)

anova = anova(full_model, null_model)
anova

p_value = anova$`Pr(>F)`[2]
p_value = round(p_value, digits = 3)
p_value

#Model diagnostics

par(mfrow = c(2,3))
plot(full_model, which = 1:5)

#Model statistics

R2_full = glance(full_model)$r.squared
R2_null = glance(null_model)$r.squared
R2_P = R2_full - R2_null

R2_full = round(R2_full, digits = 2)
R2_P = round(R2_P, digits = 2)
```

-   p value of patch type: `r p_value`

-   R2 of patch type: `r R2_P`

##### Pau

```{r}
ds_patches %>%
      filter(
        disturbance == disturbance_input,
        patch_size == patch_size_input
      ) %>%
      ggplot(
        aes(
          x = day,
          y = Pau,
          group = interaction(day, eco_metaeco_type),
          fill = eco_metaeco_type
        )
      ) +
      geom_boxplot() +
      labs(
        x = "Day",
        y = "Pau Density (indiv/μl ?)",
        fill = "",
        caption = "Vertical grey line: resource flow"
      ) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      scale_fill_manual(
        values = c(colour_isolated, colour_different_size, colour_same_size),
        labels = c(
          "Small isolated",
          "Small connected to large",
          "Small connected to small"
        )
      )  +
      scale_x_continuous(breaks = unique(ds_patches$day)) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      )
```

```{r}
ds_patches_effect_size %>%
      filter(disturbance == disturbance_input,
             eco_metaeco_type %in% c("S (S_L)", "S (S_S)"),
             day > 0) %>%
      ggplot(aes(
        x = day,
        y = Pau_d,
        color = eco_metaeco_type
      )) +
      geom_point(position = position_dodge(0.5)) +
      geom_line(position = position_dodge(0.5)) +
      geom_errorbar(
        aes(ymin = Pau_d_lower,
            ymax = Pau_d_upper),
        width = .2,
        position = position_dodge(0.5)
      ) +
      labs(
        title = paste("Disturbance =", disturbance_input),
        x = "Day",
        y = "Pau Density Effect Size (Hedge's d)",
        color = ""
      ) +
       scale_color_discrete(
         labels = c("Small connected to large",
                    "Small connnected to small")
       ) +
      scale_x_continuous(breaks = unique(ds_patches_effect_size$day)) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_hline(
        yintercept = 0,
        linetype = "dotted",
        color = "black",
        size = 0.7
      )
```

```{r}

#Filter data

filtered_data = ds_patches_effect_size %>%
  filter(patch_size == patch_size_input,
         disturbance == disturbance_input,
         time_point >= first_time_point_model,
         time_point <= last_time_point_model)

#Test hp 

full_model = lm(Pau_d ~                  
                  day + 
                  eco_metaeco_type + 
                  day : eco_metaeco_type,
                  data = filtered_data)

null_model = lm(Pau_d ~                  
                  day,
                  data = filtered_data)

AIC(full_model, null_model)

anova = anova(full_model, null_model)
anova

p_value = anova$`Pr(>F)`[2]
p_value = round(p_value, digits = 3)
p_value

#Model diagnostics

par(mfrow = c(2,3))
plot(full_model, which = 1:5)

#Model statistics

R2_full = glance(full_model)$r.squared
R2_null = glance(null_model)$r.squared
R2_P = R2_full - R2_null

R2_full = round(R2_full, digits = 2)
R2_P = round(R2_P, digits = 2)
```

-   p value of patch type: `r p_value`

-   R2 of patch type: `r R2_P`

##### Pca

```{r}
ds_patches %>%
      filter(
        disturbance == disturbance_input,
        patch_size == patch_size_input
      ) %>%
      ggplot(
        aes(
          x = day,
          y = Pca,
          group = interaction(day, eco_metaeco_type),
          fill = eco_metaeco_type
        )
      ) +
      geom_boxplot() +
      labs(
        x = "Day",
        y = "Pca Density (indiv/μl ?)",
        fill = "",
        caption = "Vertical grey line: resource flow"
      ) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      scale_fill_manual(
        values = c(colour_isolated, colour_different_size, colour_same_size),
        labels = c(
          "Small isolated",
          "Small connected to large",
          "Small connected to small"
        )
      )  +
      scale_x_continuous(breaks = unique(ds_patches$day)) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      )
```

```{r}
ds_patches_effect_size %>%
      filter(disturbance == disturbance_input,
             eco_metaeco_type %in% c("S (S_L)", "S (S_S)"),
             day > 0) %>%
      ggplot(aes(
        x = day,
        y = Pca_d,
        color = eco_metaeco_type
      )) +
      geom_point(position = position_dodge(0.5)) +
      geom_line(position = position_dodge(0.5)) +
      geom_errorbar(
        aes(ymin = Pca_d_lower,
            ymax = Pca_d_upper),
        width = .2,
        position = position_dodge(0.5)
      ) +
      labs(
        title = paste("Disturbance =", disturbance_input),
        x = "Day",
        y = "Pca Density Effect Size (Hedge's d)",
        color = ""
      ) +
       scale_color_discrete(
         labels = c("Small connected to large",
                    "Small connnected to small")
       ) +
      scale_x_continuous(breaks = unique(ds_patches_effect_size$day)) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_hline(
        yintercept = 0,
        linetype = "dotted",
        color = "black",
        size = 0.7
      )
```

```{r}

#Filter data

filtered_data = ds_patches_effect_size %>%
  filter(patch_size == patch_size_input,
         disturbance == disturbance_input,
         time_point >= first_time_point_model,
         time_point <= last_time_point_model)

#Test hp 

full_model = lm(Pca_d ~                  
                  day + 
                  eco_metaeco_type + 
                  day : eco_metaeco_type,
                  data = filtered_data)

null_model = lm(Pca_d ~                  
                  day,
                  data = filtered_data)

AIC(full_model, null_model)

anova = anova(full_model, null_model)
anova

p_value = anova$`Pr(>F)`[2]
p_value = round(p_value, digits = 3)
p_value

#Model diagnostics

par(mfrow = c(2,3))
plot(full_model, which = 1:5)

#Model statistics

R2_full = glance(full_model)$r.squared
R2_null = glance(null_model)$r.squared
R2_P = R2_full - R2_null

R2_full = round(R2_full, digits = 2)
R2_P = round(R2_P, digits = 2)
```

-   p value of patch type: `r p_value`

-   R2 of patch type: `r R2_P`

##### Spi

```{r}
ds_patches %>%
      filter(
        disturbance == disturbance_input,
        patch_size == patch_size_input
      ) %>%
      ggplot(
        aes(
          x = day,
          y = Col,
          group = interaction(day, eco_metaeco_type),
          fill = eco_metaeco_type
        )
      ) +
      geom_boxplot() +
      labs(
        x = "Day",
        y = "Spi Density (indiv/μl ?)",
        fill = "",
        caption = "Vertical grey line: resource flow"
      ) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      scale_fill_manual(
        values = c(colour_isolated, colour_different_size, colour_same_size),
        labels = c(
          "Small isolated",
          "Small connected to large",
          "Small connected to small"
        )
      )  +
      scale_x_continuous(breaks = unique(ds_patches$day)) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      )
```

```{r}
ds_patches_effect_size %>%
      filter(disturbance == disturbance_input,
             eco_metaeco_type %in% c("S (S_L)", "S (S_S)"),
             day > 0) %>%
      ggplot(aes(
        x = day,
        y = Spi_d,
        color = eco_metaeco_type
      )) +
      geom_point(position = position_dodge(0.5)) +
      geom_line(position = position_dodge(0.5)) +
      geom_errorbar(
        aes(ymin = Spi_d_lower,
            ymax = Spi_d_upper),
        width = .2,
        position = position_dodge(0.5)
      ) +
      labs(
        title = paste("Disturbance =", disturbance_input),
        x = "Day",
        y = "Spi Density Effect Size (Hedge's d)",
        color = ""
      ) +
       scale_color_discrete(
         labels = c("Small connected to large",
                    "Small connnected to small")
       ) +
      scale_x_continuous(breaks = unique(ds_patches_effect_size$day)) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_hline(
        yintercept = 0,
        linetype = "dotted",
        color = "black",
        size = 0.7
      )
```

```{r}

#Filter data

filtered_data = ds_patches_effect_size %>%
  filter(patch_size == patch_size_input,
         disturbance == disturbance_input,
         time_point >= first_time_point_model,
         time_point <= last_time_point_model)

#Test hp 

full_model = lm(Spi_d ~                  
                  day + 
                  eco_metaeco_type + 
                  day : eco_metaeco_type,
                  data = filtered_data)

null_model = lm(Spi_d ~                  
                  day,
                  data = filtered_data)

AIC(full_model, null_model)

anova = anova(full_model, null_model)
anova

p_value = anova$`Pr(>F)`[2]
p_value = round(p_value, digits = 3)
p_value

#Model diagnostics

par(mfrow = c(2,3))
plot(full_model, which = 1:5)

#Model statistics

R2_full = glance(full_model)$r.squared
R2_null = glance(null_model)$r.squared
R2_P = R2_full - R2_null

R2_full = round(R2_full, digits = 2)
R2_P = round(R2_P, digits = 2)
```

-   p value of patch type: `r p_value`

-   R2 of patch type: `r R2_P`

##### Spi_te

```{r}
ds_patches %>%
      filter(
        disturbance == disturbance_input,
        patch_size == patch_size_input
      ) %>%
      ggplot(
        aes(
          x = day,
          y = Spi_te,
          group = interaction(day, eco_metaeco_type),
          fill = eco_metaeco_type
        )
      ) +
      geom_boxplot() +
      labs(
        x = "Day",
        y = "Spi_te Density (indiv/μl ?)",
        fill = "",
        caption = "Vertical grey line: resource flow"
      ) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      scale_fill_manual(
        values = c(colour_isolated, colour_different_size, colour_same_size),
        labels = c(
          "Small isolated",
          "Small connected to large",
          "Small connected to small"
        )
      )  +
      scale_x_continuous(breaks = unique(ds_patches$day)) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      )
```

```{r}
ds_patches_effect_size %>%
      filter(disturbance == disturbance_input,
             eco_metaeco_type %in% c("S (S_L)", "S (S_S)"),
             day > 0) %>%
      ggplot(aes(
        x = day,
        y = Spi_te_d,
        color = eco_metaeco_type
      )) +
      geom_point(position = position_dodge(0.5)) +
      geom_line(position = position_dodge(0.5)) +
      geom_errorbar(
        aes(ymin = Spi_te_d_lower,
            ymax = Spi_te_d_upper),
        width = .2,
        position = position_dodge(0.5)
      ) +
      labs(
        title = paste("Disturbance =", disturbance_input),
        x = "Day",
        y = "Spi_te Density Effect Size (Hedge's d)",
        color = ""
      ) +
       scale_color_discrete(
         labels = c("Small connected to large",
                    "Small connnected to small")
       ) +
      scale_x_continuous(breaks = unique(ds_patches_effect_size$day)) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_hline(
        yintercept = 0,
        linetype = "dotted",
        color = "black",
        size = 0.7
      )
```

```{r}

#Filter data

filtered_data = ds_patches_effect_size %>%
  filter(patch_size == patch_size_input,
         disturbance == disturbance_input,
         time_point >= first_time_point_model,
         time_point <= last_time_point_model)

#Test hp 

full_model = lm(Spi_te_d ~                  
                  day + 
                  eco_metaeco_type + 
                  day : eco_metaeco_type,
                  data = filtered_data)

null_model = lm(Spi_te_d ~                  
                  day,
                  data = filtered_data)

AIC(full_model, null_model)

anova = anova(full_model, null_model)
anova

p_value = anova$`Pr(>F)`[2]
p_value = round(p_value, digits = 3)
p_value

#Model diagnostics

par(mfrow = c(2,3))
plot(full_model, which = 1:5)

#Model statistics

R2_full = glance(full_model)$r.squared
R2_null = glance(null_model)$r.squared
R2_P = R2_full - R2_null

R2_full = round(R2_full, digits = 2)
R2_P = round(R2_P, digits = 2)
```

-   p value of patch type: `r p_value`

-   R2 of patch type: `r R2_P`

##### Tet

```{r}
ds_patches %>%
      filter(
        disturbance == disturbance_input,
        patch_size == patch_size_input
      ) %>%
      ggplot(
        aes(
          x = day,
          y = Tet,
          group = interaction(day, eco_metaeco_type),
          fill = eco_metaeco_type
        )
      ) +
      geom_boxplot() +
      labs(
        x = "Day",
        y = "Tet Density (indiv/μl ?)",
        fill = "",
        caption = "Vertical grey line: resource flow"
      ) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      scale_fill_manual(
        values = c(colour_isolated, colour_different_size, colour_same_size),
        labels = c(
          "Small isolated",
          "Small connected to large",
          "Small connected to small"
        )
      )  +
      scale_x_continuous(breaks = unique(ds_patches$day)) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      )
```

```{r}
ds_patches_effect_size %>%
      filter(disturbance == disturbance_input,
             eco_metaeco_type %in% c("S (S_L)", "S (S_S)"),
             day > 0) %>%
      ggplot(aes(
        x = day,
        y = Tet_d,
        color = eco_metaeco_type
      )) +
      geom_point(position = position_dodge(0.5)) +
      geom_line(position = position_dodge(0.5)) +
      geom_errorbar(
        aes(ymin = Tet_d_lower,
            ymax = Tet_d_upper),
        width = .2,
        position = position_dodge(0.5)
      ) +
      labs(
        title = paste("Disturbance =", disturbance_input),
        x = "Day",
        y = "Tet Density Effect Size (Hedge's d)",
        color = ""
      ) +
       scale_color_discrete(
         labels = c("Small connected to large",
                    "Small connnected to small")
       ) +
      scale_x_continuous(breaks = unique(ds_patches_effect_size$day)) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_hline(
        yintercept = 0,
        linetype = "dotted",
        color = "black",
        size = 0.7
      )
```

```{r}

#Filter data

filtered_data = ds_patches_effect_size %>%
  filter(patch_size == patch_size_input,
         disturbance == disturbance_input,
         time_point >= first_time_point_model,
         time_point <= last_time_point_model)

#Test hp 

full_model = lm(Tet_d ~                  
                  day + 
                  eco_metaeco_type + 
                  day : eco_metaeco_type,
                  data = filtered_data)

null_model = lm(Tet_d ~                  
                  day,
                  data = filtered_data)

AIC(full_model, null_model)

anova = anova(full_model, null_model)
anova

p_value = anova$`Pr(>F)`[2]
p_value = round(p_value, digits = 3)
p_value

#Model diagnostics

par(mfrow = c(2,3))
plot(full_model, which = 1:5)

#Model statistics

R2_full = glance(full_model)$r.squared
R2_null = glance(null_model)$r.squared
R2_P = R2_full - R2_null

R2_full = round(R2_full, digits = 2)
R2_P = round(R2_P, digits = 2)
```

-   p value of patch type: `r p_value`

-   R2 of patch type: `r R2_P`

#### High disturbance {.tabset}

```{r}
disturbance_input = "high"
```

##### Ble

```{r}
ds_patches %>%
      filter(
        disturbance == disturbance_input,
        patch_size == patch_size_input
      ) %>%
      ggplot(
        aes(
          x = day,
          y = Ble,
          group = interaction(day, eco_metaeco_type),
          fill = eco_metaeco_type
        )
      ) +
      geom_boxplot() +
      labs(
        x = "Day",
        y = "Ble Density (indiv/μl ?)",
        fill = "",
        caption = "Vertical grey line: resource flow"
      ) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      scale_fill_manual(
        values = c(colour_isolated, colour_different_size, colour_same_size),
        labels = c(
          "Small isolated",
          "Small connected to large",
          "Small connected to small"
        )
      )  +
      scale_x_continuous(breaks = unique(ds_patches$day)) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      )
```

```{r}
ds_patches_effect_size %>%
      filter(disturbance == disturbance_input,
             eco_metaeco_type %in% c("S (S_L)", "S (S_S)"),
             day > 0) %>%
      ggplot(aes(
        x = day,
        y = Ble_d,
        color = eco_metaeco_type
      )) +
      geom_point(position = position_dodge(0.5)) +
      geom_line(position = position_dodge(0.5)) +
      geom_errorbar(
        aes(ymin = Ble_d_lower,
            ymax = Ble_d_upper),
        width = .2,
        position = position_dodge(0.5)
      ) +
      labs(
        title = paste("Disturbance =", disturbance_input),
        x = "Day",
        y = "Ble Density Effect Size (Hedge's d)",
        color = ""
      ) +
       scale_color_discrete(
         labels = c("Small connected to large",
                    "Small connnected to small")
       ) +
      scale_x_continuous(breaks = unique(ds_patches_effect_size$day)) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_hline(
        yintercept = 0,
        linetype = "dotted",
        color = "black",
        size = 0.7
      )
```

```{r}

#Filter data

filtered_data = ds_patches_effect_size %>%
  filter(patch_size == patch_size_input,
         disturbance == disturbance_input,
         time_point >= first_time_point_model,
         time_point <= last_time_point_model)

#Test hp 

full_model = lm(Ble_d ~                  
                  day + 
                  eco_metaeco_type + 
                  day : eco_metaeco_type,
                  data = filtered_data)

null_model = lm(Ble_d ~                  
                  day,
                  data = filtered_data)

AIC(full_model, null_model)

anova = anova(full_model, null_model)
anova

p_value = anova$`Pr(>F)`[2]
p_value = round(p_value, digits = 3)
p_value

#Model diagnostics

par(mfrow = c(2,3))
plot(full_model, which = 1:5)

#Model statistics

R2_full = glance(full_model)$r.squared
R2_null = glance(null_model)$r.squared
R2_P = R2_full - R2_null

R2_full = round(R2_full, digits = 2)
R2_P = round(R2_P, digits = 2)
```

-   p value of patch type: `r p_value`

-   R2 of patch type: `r R2_P`

##### Cep

```{r}
ds_patches %>%
      filter(
        disturbance == disturbance_input,
        patch_size == patch_size_input
      ) %>%
      ggplot(
        aes(
          x = day,
          y = Cep,
          group = interaction(day, eco_metaeco_type),
          fill = eco_metaeco_type
        )
      ) +
      geom_boxplot() +
      labs(
        x = "Day",
        y = "Cep Density (indiv/μl ?)",
        fill = "",
        caption = "Vertical grey line: resource flow"
      ) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      scale_fill_manual(
        values = c(colour_isolated, colour_different_size, colour_same_size),
        labels = c(
          "Small isolated",
          "Small connected to large",
          "Small connected to small"
        )
      )  +
      scale_x_continuous(breaks = unique(ds_patches$day)) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      )
```

```{r}
ds_patches_effect_size %>%
      filter(disturbance == disturbance_input,
             eco_metaeco_type %in% c("S (S_L)", "S (S_S)"),
             day > 0) %>%
      ggplot(aes(
        x = day,
        y = Cep_d,
        color = eco_metaeco_type
      )) +
      geom_point(position = position_dodge(0.5)) +
      geom_line(position = position_dodge(0.5)) +
      geom_errorbar(
        aes(ymin = Cep_d_lower,
            ymax = Cep_d_upper),
        width = .2,
        position = position_dodge(0.5)
      ) +
      labs(
        title = paste("Disturbance =", disturbance_input),
        x = "Day",
        y = "Cep Density Effect Size (Hedge's d)",
        color = ""
      ) +
       scale_color_discrete(
         labels = c("Small connected to large",
                    "Small connnected to small")
       ) +
      scale_x_continuous(breaks = unique(ds_patches_effect_size$day)) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_hline(
        yintercept = 0,
        linetype = "dotted",
        color = "black",
        size = 0.7
      )
```

```{r}

#Filter data

filtered_data = ds_patches_effect_size %>%
  filter(patch_size == patch_size_input,
         disturbance == disturbance_input,
         time_point >= first_time_point_model,
         time_point <= last_time_point_model)

#Test hp 

full_model = lm(Cep_d ~                  
                  day + 
                  eco_metaeco_type + 
                  day : eco_metaeco_type,
                  data = filtered_data)

null_model = lm(Cep_d ~                  
                  day,
                  data = filtered_data)

AIC(full_model, null_model)

anova = anova(full_model, null_model)
anova

p_value = anova$`Pr(>F)`[2]
p_value = round(p_value, digits = 3)
p_value

#Model diagnostics

par(mfrow = c(2,3))
plot(full_model, which = 1:5)

#Model statistics

R2_full = glance(full_model)$r.squared
R2_null = glance(null_model)$r.squared
R2_P = R2_full - R2_null

R2_full = round(R2_full, digits = 2)
R2_P = round(R2_P, digits = 2)
```

-   p value of patch type: `r p_value`

-   R2 of patch type: `r R2_P`

##### Col

```{r}
ds_patches %>%
      filter(
        disturbance == disturbance_input,
        patch_size == patch_size_input
      ) %>%
      ggplot(
        aes(
          x = day,
          y = Col,
          group = interaction(day, eco_metaeco_type),
          fill = eco_metaeco_type
        )
      ) +
      geom_boxplot() +
      labs(
        x = "Day",
        y = "Col Density (indiv/μl ?)",
        fill = "",
        caption = "Vertical grey line: resource flow"
      ) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      scale_fill_manual(
        values = c(colour_isolated, colour_different_size, colour_same_size),
        labels = c(
          "Small isolated",
          "Small connected to large",
          "Small connected to small"
        )
      )  +
      scale_x_continuous(breaks = unique(ds_patches$day)) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      )
```

```{r}
ds_patches_effect_size %>%
      filter(disturbance == disturbance_input,
             eco_metaeco_type %in% c("S (S_L)", "S (S_S)"),
             day > 0) %>%
      ggplot(aes(
        x = day,
        y = Col_d,
        color = eco_metaeco_type
      )) +
      geom_point(position = position_dodge(0.5)) +
      geom_line(position = position_dodge(0.5)) +
      geom_errorbar(
        aes(ymin = Col_d_lower,
            ymax = Col_d_upper),
        width = .2,
        position = position_dodge(0.5)
      ) +
      labs(
        title = paste("Disturbance =", disturbance_input),
        x = "Day",
        y = "Col Density Effect Size (Hedge's d)",
        color = ""
      ) +
       scale_color_discrete(
         labels = c("Small connected to large",
                    "Small connnected to small")
       ) +
      scale_x_continuous(breaks = unique(ds_patches_effect_size$day)) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_hline(
        yintercept = 0,
        linetype = "dotted",
        color = "black",
        size = 0.7
      )
```

```{r}

#Filter data

filtered_data = ds_patches_effect_size %>%
  filter(patch_size == patch_size_input,
         disturbance == disturbance_input,
         time_point >= first_time_point_model,
         time_point <= last_time_point_model)

#Test hp 

full_model = lm(Col_d ~                  
                  day + 
                  eco_metaeco_type + 
                  day : eco_metaeco_type,
                  data = filtered_data)

null_model = lm(Col_d ~                  
                  day,
                  data = filtered_data)

AIC(full_model, null_model)

anova = anova(full_model, null_model)
anova

p_value = anova$`Pr(>F)`[2]
p_value = round(p_value, digits = 3)
p_value

#Model diagnostics

par(mfrow = c(2,3))
plot(full_model, which = 1:5)

#Model statistics

R2_full = glance(full_model)$r.squared
R2_null = glance(null_model)$r.squared
R2_P = R2_full - R2_null

R2_full = round(R2_full, digits = 2)
R2_P = round(R2_P, digits = 2)
```

-   p value of patch type: `r p_value`

-   R2 of patch type: `r R2_P`

##### Eug

```{r}
ds_patches %>%
      filter(
        disturbance == disturbance_input,
        patch_size == patch_size_input
      ) %>%
      ggplot(
        aes(
          x = day,
          y = Eug,
          group = interaction(day, eco_metaeco_type),
          fill = eco_metaeco_type
        )
      ) +
      geom_boxplot() +
      labs(
        x = "Day",
        y = "Eug Density (indiv/μl ?)",
        fill = "",
        caption = "Vertical grey line: resource flow"
      ) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      scale_fill_manual(
        values = c(colour_isolated, colour_different_size, colour_same_size),
        labels = c(
          "Small isolated",
          "Small connected to large",
          "Small connected to small"
        )
      )  +
      scale_x_continuous(breaks = unique(ds_patches$day)) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      )
```

```{r}
ds_patches_effect_size %>%
      filter(disturbance == disturbance_input,
             eco_metaeco_type %in% c("S (S_L)", "S (S_S)"),
             day > 0) %>%
      ggplot(aes(
        x = day,
        y = Eug_d,
        color = eco_metaeco_type
      )) +
      geom_point(position = position_dodge(0.5)) +
      geom_line(position = position_dodge(0.5)) +
      geom_errorbar(
        aes(ymin = Eug_d_lower,
            ymax = Eug_d_upper),
        width = .2,
        position = position_dodge(0.5)
      ) +
      labs(
        title = paste("Disturbance =", disturbance_input),
        x = "Day",
        y = "Eug Density Effect Size (Hedge's d)",
        color = ""
      ) +
       scale_color_discrete(
         labels = c("Small connected to large",
                    "Small connnected to small")
       ) +
      scale_x_continuous(breaks = unique(ds_patches_effect_size$day)) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_hline(
        yintercept = 0,
        linetype = "dotted",
        color = "black",
        size = 0.7
      )
```

Can't compute because not enough effect sizes.

```{r eval = FALSE}

#Filter data

filtered_data = ds_patches_effect_size %>%
  filter(patch_size == patch_size_input,
         disturbance == disturbance_input,
         time_point >= first_time_point_model,
         time_point <= last_time_point_model)

#Test hp 

full_model = lm(Eug_d ~                  
                  day + 
                  eco_metaeco_type + 
                  day : eco_metaeco_type,
                  data = filtered_data)

null_model = lm(Eug_d ~                  
                  day,
                  data = filtered_data)

AIC(full_model, null_model)

anova = anova(full_model, null_model)
anova

p_value = anova$`Pr(>F)`[2]
p_value = round(p_value, digits = 3)
p_value

#Model diagnostics

par(mfrow = c(2,3))
plot(full_model, which = 1:5)

#Model statistics

R2_full = glance(full_model)$r.squared
R2_null = glance(null_model)$r.squared
R2_P = R2_full - R2_null

R2_full = round(R2_full, digits = 2)
R2_P = round(R2_P, digits = 2)
```

##### Eup

```{r}
ds_patches %>%
      filter(
        disturbance == disturbance_input,
        patch_size == patch_size_input
      ) %>%
      ggplot(
        aes(
          x = day,
          y = Eup,
          group = interaction(day, eco_metaeco_type),
          fill = eco_metaeco_type
        )
      ) +
      geom_boxplot() +
      labs(
        x = "Day",
        y = "Eup Density (indiv/μl ?)",
        fill = "",
        caption = "Vertical grey line: resource flow"
      ) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      scale_fill_manual(
        values = c(colour_isolated, colour_different_size, colour_same_size),
        labels = c(
          "Small isolated",
          "Small connected to large",
          "Small connected to small"
        )
      )  +
      scale_x_continuous(breaks = unique(ds_patches$day)) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      )
```

```{r}
ds_patches_effect_size %>%
      filter(disturbance == disturbance_input,
             eco_metaeco_type %in% c("S (S_L)", "S (S_S)"),
             day > 0) %>%
      ggplot(aes(
        x = day,
        y = Eup_d,
        color = eco_metaeco_type
      )) +
      geom_point(position = position_dodge(0.5)) +
      geom_line(position = position_dodge(0.5)) +
      geom_errorbar(
        aes(ymin = Eup_d_lower,
            ymax = Eup_d_upper),
        width = .2,
        position = position_dodge(0.5)
      ) +
      labs(
        title = paste("Disturbance =", disturbance_input),
        x = "Day",
        y = "Eup Density Effect Size (Hedge's d)",
        color = ""
      ) +
       scale_color_discrete(
         labels = c("Small connected to large",
                    "Small connnected to small")
       ) +
      scale_x_continuous(breaks = unique(ds_patches_effect_size$day)) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_hline(
        yintercept = 0,
        linetype = "dotted",
        color = "black",
        size = 0.7
      )
```

```{r}

#Filter data

filtered_data = ds_patches_effect_size %>%
  filter(patch_size == patch_size_input,
         disturbance == disturbance_input,
         time_point >= first_time_point_model,
         time_point <= last_time_point_model)

#Test hp 

full_model = lm(Eup_d ~                  
                  day + 
                  eco_metaeco_type + 
                  day : eco_metaeco_type,
                  data = filtered_data)

null_model = lm(Eup_d ~                  
                  day,
                  data = filtered_data)

AIC(full_model, null_model)

anova = anova(full_model, null_model)
anova

p_value = anova$`Pr(>F)`[2]
p_value = round(p_value, digits = 3)
p_value

#Model diagnostics

par(mfrow = c(2,3))
plot(full_model, which = 1:5)

#Model statistics

R2_full = glance(full_model)$r.squared
R2_null = glance(null_model)$r.squared
R2_P = R2_full - R2_null

R2_full = round(R2_full, digits = 2)
R2_P = round(R2_P, digits = 2)
```

-   p value of patch type: `r p_value`

-   R2 of patch type: `r R2_P`

##### Lox

```{r}
ds_patches %>%
      filter(
        disturbance == disturbance_input,
        patch_size == patch_size_input
      ) %>%
      ggplot(
        aes(
          x = day,
          y = Lox,
          group = interaction(day, eco_metaeco_type),
          fill = eco_metaeco_type
        )
      ) +
      geom_boxplot() +
      labs(
        x = "Day",
        y = "Lox Density (indiv/μl ?)",
        fill = "",
        caption = "Vertical grey line: resource flow"
      ) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      scale_fill_manual(
        values = c(colour_isolated, colour_different_size, colour_same_size),
        labels = c(
          "Small isolated",
          "Small connected to large",
          "Small connected to small"
        )
      )  +
      scale_x_continuous(breaks = unique(ds_patches$day)) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      )
```

```{r}
ds_patches_effect_size %>%
      filter(disturbance == disturbance_input,
             eco_metaeco_type %in% c("S (S_L)", "S (S_S)"),
             day > 0) %>%
      ggplot(aes(
        x = day,
        y = Lox_d,
        color = eco_metaeco_type
      )) +
      geom_point(position = position_dodge(0.5)) +
      geom_line(position = position_dodge(0.5)) +
      geom_errorbar(
        aes(ymin = Lox_d_lower,
            ymax = Lox_d_upper),
        width = .2,
        position = position_dodge(0.5)
      ) +
      labs(
        title = paste("Disturbance =", disturbance_input),
        x = "Day",
        y = "Lox Density Effect Size (Hedge's d)",
        color = ""
      ) +
       scale_color_discrete(
         labels = c("Small connected to large",
                    "Small connnected to small")
       ) +
      scale_x_continuous(breaks = unique(ds_patches_effect_size$day)) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_hline(
        yintercept = 0,
        linetype = "dotted",
        color = "black",
        size = 0.7
      )
```

```{r}

#Filter data

filtered_data = ds_patches_effect_size %>%
  filter(patch_size == patch_size_input,
         disturbance == disturbance_input,
         time_point >= first_time_point_model,
         time_point <= last_time_point_model)

#Test hp 

full_model = lm(Lox_d ~                  
                  day + 
                  eco_metaeco_type + 
                  day : eco_metaeco_type,
                  data = filtered_data)

null_model = lm(Lox_d ~                  
                  day,
                  data = filtered_data)

AIC(full_model, null_model)

anova = anova(full_model, null_model)
anova

p_value = anova$`Pr(>F)`[2]
p_value = round(p_value, digits = 3)
p_value

#Model diagnostics

par(mfrow = c(2,3))
plot(full_model, which = 1:5)

#Model statistics

R2_full = glance(full_model)$r.squared
R2_null = glance(null_model)$r.squared
R2_P = R2_full - R2_null

R2_full = round(R2_full, digits = 2)
R2_P = round(R2_P, digits = 2)
```

-   p value of patch type: `r p_value`

-   R2 of patch type: `r R2_P`

##### Pau

```{r}
ds_patches %>%
      filter(
        disturbance == disturbance_input,
        patch_size == patch_size_input
      ) %>%
      ggplot(
        aes(
          x = day,
          y = Pau,
          group = interaction(day, eco_metaeco_type),
          fill = eco_metaeco_type
        )
      ) +
      geom_boxplot() +
      labs(
        x = "Day",
        y = "Pau Density (indiv/μl ?)",
        fill = "",
        caption = "Vertical grey line: resource flow"
      ) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      scale_fill_manual(
        values = c(colour_isolated, colour_different_size, colour_same_size),
        labels = c(
          "Small isolated",
          "Small connected to large",
          "Small connected to small"
        )
      )  +
      scale_x_continuous(breaks = unique(ds_patches$day)) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      )
```

```{r}
ds_patches_effect_size %>%
      filter(disturbance == disturbance_input,
             eco_metaeco_type %in% c("S (S_L)", "S (S_S)"),
             day > 0) %>%
      ggplot(aes(
        x = day,
        y = Pau_d,
        color = eco_metaeco_type
      )) +
      geom_point(position = position_dodge(0.5)) +
      geom_line(position = position_dodge(0.5)) +
      geom_errorbar(
        aes(ymin = Pau_d_lower,
            ymax = Pau_d_upper),
        width = .2,
        position = position_dodge(0.5)
      ) +
      labs(
        title = paste("Disturbance =", disturbance_input),
        x = "Day",
        y = "Pau Density Effect Size (Hedge's d)",
        color = ""
      ) +
       scale_color_discrete(
         labels = c("Small connected to large",
                    "Small connnected to small")
       ) +
      scale_x_continuous(breaks = unique(ds_patches_effect_size$day)) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_hline(
        yintercept = 0,
        linetype = "dotted",
        color = "black",
        size = 0.7
      )
```

```{r}

#Filter data

filtered_data = ds_patches_effect_size %>%
  filter(patch_size == patch_size_input,
         disturbance == disturbance_input,
         time_point >= first_time_point_model,
         time_point <= last_time_point_model)

#Test hp 

full_model = lm(Pau_d ~                  
                  day + 
                  eco_metaeco_type + 
                  day : eco_metaeco_type,
                  data = filtered_data)

null_model = lm(Pau_d ~                  
                  day,
                  data = filtered_data)

AIC(full_model, null_model)

anova = anova(full_model, null_model)
anova

p_value = anova$`Pr(>F)`[2]
p_value = round(p_value, digits = 3)
p_value

#Model diagnostics

par(mfrow = c(2,3))
plot(full_model, which = 1:5)

#Model statistics

R2_full = glance(full_model)$r.squared
R2_null = glance(null_model)$r.squared
R2_P = R2_full - R2_null

R2_full = round(R2_full, digits = 2)
R2_P = round(R2_P, digits = 2)
```

-   p value of patch type: `r p_value`

-   R2 of patch type: `r R2_P`

##### Pca

```{r}
ds_patches %>%
      filter(
        disturbance == disturbance_input,
        patch_size == patch_size_input
      ) %>%
      ggplot(
        aes(
          x = day,
          y = Pca,
          group = interaction(day, eco_metaeco_type),
          fill = eco_metaeco_type
        )
      ) +
      geom_boxplot() +
      labs(
        x = "Day",
        y = "Pca Density (indiv/μl ?)",
        fill = "",
        caption = "Vertical grey line: resource flow"
      ) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      scale_fill_manual(
        values = c(colour_isolated, colour_different_size, colour_same_size),
        labels = c(
          "Small isolated",
          "Small connected to large",
          "Small connected to small"
        )
      )  +
      scale_x_continuous(breaks = unique(ds_patches$day)) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      )
```

```{r}
ds_patches_effect_size %>%
      filter(disturbance == disturbance_input,
             eco_metaeco_type %in% c("S (S_L)", "S (S_S)"),
             day > 0) %>%
      ggplot(aes(
        x = day,
        y = Pca_d,
        color = eco_metaeco_type
      )) +
      geom_point(position = position_dodge(0.5)) +
      geom_line(position = position_dodge(0.5)) +
      geom_errorbar(
        aes(ymin = Pca_d_lower,
            ymax = Pca_d_upper),
        width = .2,
        position = position_dodge(0.5)
      ) +
      labs(
        title = paste("Disturbance =", disturbance_input),
        x = "Day",
        y = "Pca Density Effect Size (Hedge's d)",
        color = ""
      ) +
       scale_color_discrete(
         labels = c("Small connected to large",
                    "Small connnected to small")
       ) +
      scale_x_continuous(breaks = unique(ds_patches_effect_size$day)) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_hline(
        yintercept = 0,
        linetype = "dotted",
        color = "black",
        size = 0.7
      )
```

```{r}

#Filter data

filtered_data = ds_patches_effect_size %>%
  filter(patch_size == patch_size_input,
         disturbance == disturbance_input,
         time_point >= first_time_point_model,
         time_point <= last_time_point_model)

#Test hp 

full_model = lm(Pca_d ~                  
                  day + 
                  eco_metaeco_type + 
                  day : eco_metaeco_type,
                  data = filtered_data)

null_model = lm(Pca_d ~                  
                  day,
                  data = filtered_data)

AIC(full_model, null_model)

anova = anova(full_model, null_model)
anova

p_value = anova$`Pr(>F)`[2]
p_value = round(p_value, digits = 3)
p_value

#Model diagnostics

par(mfrow = c(2,3))
plot(full_model, which = 1:5)

#Model statistics

R2_full = glance(full_model)$r.squared
R2_null = glance(null_model)$r.squared
R2_P = R2_full - R2_null

R2_full = round(R2_full, digits = 2)
R2_P = round(R2_P, digits = 2)
```

-   p value of patch type: `r p_value`

-   R2 of patch type: `r R2_P`

##### Spi

```{r}
ds_patches %>%
      filter(
        disturbance == disturbance_input,
        patch_size == patch_size_input
      ) %>%
      ggplot(
        aes(
          x = day,
          y = Col,
          group = interaction(day, eco_metaeco_type),
          fill = eco_metaeco_type
        )
      ) +
      geom_boxplot() +
      labs(
        x = "Day",
        y = "Spi Density (indiv/μl ?)",
        fill = "",
        caption = "Vertical grey line: resource flow"
      ) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      scale_fill_manual(
        values = c(colour_isolated, colour_different_size, colour_same_size),
        labels = c(
          "Small isolated",
          "Small connected to large",
          "Small connected to small"
        )
      )  +
      scale_x_continuous(breaks = unique(ds_patches$day)) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      )
```

```{r}
ds_patches_effect_size %>%
      filter(disturbance == disturbance_input,
             eco_metaeco_type %in% c("S (S_L)", "S (S_S)"),
             day > 0) %>%
      ggplot(aes(
        x = day,
        y = Spi_d,
        color = eco_metaeco_type
      )) +
      geom_point(position = position_dodge(0.5)) +
      geom_line(position = position_dodge(0.5)) +
      geom_errorbar(
        aes(ymin = Spi_d_lower,
            ymax = Spi_d_upper),
        width = .2,
        position = position_dodge(0.5)
      ) +
      labs(
        title = paste("Disturbance =", disturbance_input),
        x = "Day",
        y = "Spi Density Effect Size (Hedge's d)",
        color = ""
      ) +
       scale_color_discrete(
         labels = c("Small connected to large",
                    "Small connnected to small")
       ) +
      scale_x_continuous(breaks = unique(ds_patches_effect_size$day)) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_hline(
        yintercept = 0,
        linetype = "dotted",
        color = "black",
        size = 0.7
      )
```

```{r}

#Filter data

filtered_data = ds_patches_effect_size %>%
  filter(patch_size == patch_size_input,
         disturbance == disturbance_input,
         time_point >= first_time_point_model,
         time_point <= last_time_point_model)

#Test hp 

full_model = lm(Spi_d ~                  
                  day + 
                  eco_metaeco_type + 
                  day : eco_metaeco_type,
                  data = filtered_data)

null_model = lm(Spi_d ~                  
                  day,
                  data = filtered_data)

AIC(full_model, null_model)

anova = anova(full_model, null_model)
anova

p_value = anova$`Pr(>F)`[2]
p_value = round(p_value, digits = 3)
p_value

#Model diagnostics

par(mfrow = c(2,3))
plot(full_model, which = 1:5)

#Model statistics

R2_full = glance(full_model)$r.squared
R2_null = glance(null_model)$r.squared
R2_P = R2_full - R2_null

R2_full = round(R2_full, digits = 2)
R2_P = round(R2_P, digits = 2)
```

-   p value of patch type: `r p_value`

-   R2 of patch type: `r R2_P`

##### Spi_te

```{r}
ds_patches %>%
      filter(
        disturbance == disturbance_input,
        patch_size == patch_size_input
      ) %>%
      ggplot(
        aes(
          x = day,
          y = Spi_te,
          group = interaction(day, eco_metaeco_type),
          fill = eco_metaeco_type
        )
      ) +
      geom_boxplot() +
      labs(
        x = "Day",
        y = "Spi_te Density (indiv/μl ?)",
        fill = "",
        caption = "Vertical grey line: resource flow"
      ) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      scale_fill_manual(
        values = c(colour_isolated, colour_different_size, colour_same_size),
        labels = c(
          "Small isolated",
          "Small connected to large",
          "Small connected to small"
        )
      )  +
      scale_x_continuous(breaks = unique(ds_patches$day)) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      )
```

```{r}
ds_patches_effect_size %>%
      filter(disturbance == disturbance_input,
             eco_metaeco_type %in% c("S (S_L)", "S (S_S)"),
             day > 0) %>%
      ggplot(aes(
        x = day,
        y = Spi_te_d,
        color = eco_metaeco_type
      )) +
      geom_point(position = position_dodge(0.5)) +
      geom_line(position = position_dodge(0.5)) +
      geom_errorbar(
        aes(ymin = Spi_te_d_lower,
            ymax = Spi_te_d_upper),
        width = .2,
        position = position_dodge(0.5)
      ) +
      labs(
        title = paste("Disturbance =", disturbance_input),
        x = "Day",
        y = "Spi_te Density Effect Size (Hedge's d)",
        color = ""
      ) +
       scale_color_discrete(
         labels = c("Small connected to large",
                    "Small connnected to small")
       ) +
      scale_x_continuous(breaks = unique(ds_patches_effect_size$day)) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_hline(
        yintercept = 0,
        linetype = "dotted",
        color = "black",
        size = 0.7
      )
```

```{r}

#Filter data

filtered_data = ds_patches_effect_size %>%
  filter(patch_size == patch_size_input,
         disturbance == disturbance_input,
         time_point >= first_time_point_model,
         time_point <= last_time_point_model)

#Test hp 

full_model = lm(Spi_te_d ~                  
                  day + 
                  eco_metaeco_type + 
                  day : eco_metaeco_type,
                  data = filtered_data)

null_model = lm(Spi_te_d ~                  
                  day,
                  data = filtered_data)

AIC(full_model, null_model)

anova = anova(full_model, null_model)
anova

p_value = anova$`Pr(>F)`[2]
p_value = round(p_value, digits = 3)
p_value

#Model diagnostics

par(mfrow = c(2,3))
plot(full_model, which = 1:5)

#Model statistics

R2_full = glance(full_model)$r.squared
R2_null = glance(null_model)$r.squared
R2_P = R2_full - R2_null

R2_full = round(R2_full, digits = 2)
R2_P = round(R2_P, digits = 2)
```

-   p value of patch type: `r p_value`

-   R2 of patch type: `r R2_P`

##### Tet

```{r}
ds_patches %>%
      filter(
        disturbance == disturbance_input,
        patch_size == patch_size_input
      ) %>%
      ggplot(
        aes(
          x = day,
          y = Tet,
          group = interaction(day, eco_metaeco_type),
          fill = eco_metaeco_type
        )
      ) +
      geom_boxplot() +
      labs(
        x = "Day",
        y = "Tet Density (indiv/μl ?)",
        fill = "",
        caption = "Vertical grey line: resource flow"
      ) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      scale_fill_manual(
        values = c(colour_isolated, colour_different_size, colour_same_size),
        labels = c(
          "Small isolated",
          "Small connected to large",
          "Small connected to small"
        )
      )  +
      scale_x_continuous(breaks = unique(ds_patches$day)) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      )
```

```{r}
ds_patches_effect_size %>%
      filter(disturbance == disturbance_input,
             eco_metaeco_type %in% c("S (S_L)", "S (S_S)"),
             day > 0) %>%
      ggplot(aes(
        x = day,
        y = Tet_d,
        color = eco_metaeco_type
      )) +
      geom_point(position = position_dodge(0.5)) +
      geom_line(position = position_dodge(0.5)) +
      geom_errorbar(
        aes(ymin = Tet_d_lower,
            ymax = Tet_d_upper),
        width = .2,
        position = position_dodge(0.5)
      ) +
      labs(
        title = paste("Disturbance =", disturbance_input),
        x = "Day",
        y = "Tet Density Effect Size (Hedge's d)",
        color = ""
      ) +
       scale_color_discrete(
         labels = c("Small connected to large",
                    "Small connnected to small")
       ) +
      scale_x_continuous(breaks = unique(ds_patches_effect_size$day)) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "bottom"
      ) +
      geom_vline(
        xintercept = resource_flow_days[1] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[2] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[3] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[4] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[5] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_vline(
        xintercept = resource_flow_days[6] + 0.7,
        linetype = "dotdash",
        color = "grey",
        size = 0.7
      ) +
      geom_hline(
        yintercept = 0,
        linetype = "dotted",
        color = "black",
        size = 0.7
      )
```

Can't evaluate because there are not enough data points. 

```{r eval = FALSE}

#Filter data

filtered_data = ds_patches_effect_size %>%
  filter(patch_size == patch_size_input,
         disturbance == disturbance_input,
         time_point >= first_time_point_model,
         time_point <= last_time_point_model)

#Test hp 

full_model = lm(Tet_d ~                  
                  day + 
                  eco_metaeco_type + 
                  day : eco_metaeco_type,
                  data = filtered_data)

null_model = lm(Tet_d ~                  
                  day,
                  data = filtered_data)

AIC(full_model, null_model)

anova = anova(full_model, null_model)
anova

p_value = anova$`Pr(>F)`[2]
p_value = round(p_value, digits = 3)
p_value

#Model diagnostics

par(mfrow = c(2,3))
plot(full_model, which = 1:5)

#Model statistics

R2_full = glance(full_model)$r.squared
R2_null = glance(null_model)$r.squared
R2_P = R2_full - R2_null

R2_full = round(R2_full, digits = 2)
R2_P = round(R2_P, digits = 2)
```