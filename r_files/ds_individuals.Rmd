---
title: "Data manipulation of body size data"
author: "Emanuele Giacomuzzo"
date: "2022-08-07"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r}
ds_individuals = import.protist.morph.data(culture_info,
                                           time_points)
```

```{r}
#Take off problematic videos
ds_individuals_before_taking_off_videos = ds_individuals

ds_individuals = ds_individuals %>%
  filter(!(time_point %in% videos_to_take_off$time_point & 
           file %in% videos_to_take_off$file))

diff = setdiff(ds_individuals_before_taking_off_videos, ds_individuals)

expect_equal(nrow(videos_to_take_off),
             nrow(expand.grid(diff$culture_ID, diff$time_point, diff$file) %>% unique()))

#Take off problematic cultures 
ds_individuals_before_taking_off_cultures = ds_individuals

ds_individuals = ds_individuals %>%
  filter(! culture_ID %in% patches_to_take_off)


expect_equal(setdiff(ds_individuals_before_taking_off_cultures, ds_individuals) %>% pull(culture_ID) %>% unique(),
             patches_to_take_off)
```

```{r}
#Rename columns
ds_individuals = ds_individuals %>% 
  rename(patch_type = eco_metaeco_type,
         patch_size_ml = patch_size_volume,
         body_area_µm2 = mean_area)
```

```{r}
#Rename the patches
ds_individuals$patch_type[ds_individuals$patch_type == "S"] = "Small isolated"
ds_individuals$patch_type[ds_individuals$patch_type == "S (S_S)"] = "Small connected to small"
ds_individuals$patch_type[ds_individuals$patch_type == "S (S_L)"] = "Small connected to large"
ds_individuals$patch_type[ds_individuals$patch_type == "M"] = "Medium isolated"
ds_individuals$patch_type[ds_individuals$patch_type == "M (M_M)"] = "Medium connected to medium"
ds_individuals$patch_type[ds_individuals$patch_type == "L"] = "Large isolated"
ds_individuals$patch_type[ds_individuals$patch_type == "L (L_L)"] = "Large connected to large"
ds_individuals$patch_type[ds_individuals$patch_type == "L (S_L)"] = "Large connected to small"

#Reorder the patches
ds_individuals = ds_individuals %>%
  mutate(patch_type = factor(
    patch_type,
    levels = c(
      "Small isolated",
      "Small connected to small",
      "Small connected to large",
      "Medium isolated",
      "Medium connected to medium",
      "Large isolated",
      "Large connected to large",
      "Large connected to small"
    )
  ))
```

```{r}
#Add the column size_connected_patch
ds_individuals$size_connected_patch = NA
ds_individuals$size_connected_patch[ds_individuals$patch_type == "Small connected to small"] = "Small"
ds_individuals$size_connected_patch[ds_individuals$patch_type == "Small connected to large"] = "Large"
ds_individuals$size_connected_patch[ds_individuals$patch_type == "Medium connected to medium"] = "Medium"
ds_individuals$size_connected_patch[ds_individuals$patch_type == "Large connected to large"] = "Large"
ds_individuals$size_connected_patch[ds_individuals$patch_type == "Large connected to small"] = "Small"
```

```{r}
#Reorder columns
ds_individuals = ds_individuals %>%
    select(time_point,
           day, 
           file, 
           video_replicate,
           disturbance, 
           culture_ID, 
           system_nr, 
           patch_type,
           patch_size, 
           patch_size_ml,
           size_connected_patch,
           metaecosystem, 
           metaecosystem_type, 
           body_area_µm2,
           N_frames
           )
```

```{r}
save(ds_individuals, file = here("results", "ds", "ds_individuals.RData"))
```