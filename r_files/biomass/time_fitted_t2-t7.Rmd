---
title: "model_all_points_with_time_fitting"
author: "Emanuele Giacomuzzo"
date: '2022-07-22'
output: html_document
editor_options: 
  chunk_output_type: console
---

## t2 - t7 with time fitting

### Tidy

```{r}
ds_regional_predicted_shrunk_type_n_day = ds_regional_predicted_shrunk_type %>%
  filter(time_point >= 2)
```

### Model selection

**Are slopes and intercept correlated?**

```{r eval = FALSE}
model_slopes_correlated = lmer(regional_mean_bioarea ~ 
                            predicted_from_time + 
                            metaecosystem_type  + 
                            disturbance + 
                            predicted_from_time * metaecosystem_type +
                            predicted_from_time * disturbance +
                            metaecosystem_type * disturbance +
                            predicted_from_time * metaecosystem_type * disturbance +
                            (predicted_from_time | system_nr),
                        data = ds_regional_predicted_shrunk_type_n_day,
                        REML = FALSE)

model_slopes_uncorrelated = lmer(regional_mean_bioarea ~ 
                            predicted_from_time + 
                            metaecosystem_type  + 
                            disturbance + 
                            predicted_from_time * metaecosystem_type +
                            predicted_from_time * disturbance +
                            metaecosystem_type * disturbance +
                            predicted_from_time * metaecosystem_type * disturbance +
                            (predicted_from_time || system_nr),
                        data = ds_regional_predicted_shrunk_type_n_day,
                        REML = FALSE)

anova(model_slopes_uncorrelated, model_slopes_correlated)
```

It doesn't work. Wired. Well, let's just keep the slopes as uncorrelated (`model_slopes_uncorrelated`).

**Does meta-ecosystem type have a different effect on regional biomass at different time (*does predicted_from_time \* metaecosystem_type have an effect*) ?**

```{r time-fitted-random-effects}
model_1 = lmer(regional_mean_bioarea ~ 
                            predicted_from_time + 
                            metaecosystem_type  + 
                            disturbance + 
                            predicted_from_time * metaecosystem_type +
                            predicted_from_time * disturbance +
                            metaecosystem_type * disturbance +
                            predicted_from_time * metaecosystem_type * disturbance +
                            (predicted_from_time || system_nr),
                        data = ds_regional_predicted_shrunk_type_n_day,
                        REML = FALSE)

model_2 = lmer(regional_mean_bioarea ~ 
                            predicted_from_time + 
                            metaecosystem_type  + 
                            disturbance + 
                            predicted_from_time * disturbance +
                            metaecosystem_type * disturbance +
                            predicted_from_time * metaecosystem_type * disturbance +
                            (predicted_from_time || system_nr),
                        data = ds_regional_predicted_shrunk_type_n_day,
                        REML = FALSE)

anova(model_1, model_2)
```

They are the same. Keep model_2.

**Does disturbance have a different effect on regional biomass at different time points (*does the interaction between time and disturbance have an effect*)?**

```{r}
model_3 = lmer(regional_mean_bioarea ~ 
                            predicted_from_time + 
                            metaecosystem_type  + 
                            disturbance + 
                            metaecosystem_type * disturbance +
                            predicted_from_time * metaecosystem_type * disturbance +
                            (predicted_from_time || system_nr),
                        data = ds_regional_predicted_shrunk_type_n_day,
                        REML = FALSE)

anova(model_2, model_3)
```

They are the same. Keep model_3.

**Does meta-ecosystem type have a different effect on regional biomass at different disturbance regimes (*does the interaction between meta-ecosystem type and disturbance have an effect*)?**

```{r}
model_4 = lmer(regional_mean_bioarea ~ 
                            predicted_from_time + 
                            metaecosystem_type  + 
                            disturbance + 
                            predicted_from_time * metaecosystem_type * disturbance +
                            (predicted_from_time || system_nr),
                        data = ds_regional_predicted_shrunk_type_n_day,
                        REML = FALSE)

anova(model_3, model_4)
```

They are the same. Keep model_4.

**Does the interaction between different meta-ecosystem types and disturbance have a different effect at different time points (*does the interaction between meta-ecosystem type, disturbance, and time have an effect*)?**

```{r}
model_5 = lmer(regional_mean_bioarea ~ 
                            predicted_from_time + 
                            metaecosystem_type  + 
                            disturbance + 
                            (predicted_from_time || system_nr),
                        data = ds_regional_predicted_shrunk_type_n_day,
                        REML = FALSE)

anova(model_4, model_5)
```

They are the same. Keep model_5.

**Does the difference in biomass between medium-medium and small-large meta-ecosystems differ across time (*does system number have a random effect on the slope of predicted from time*)?**

```{r}

#Take off disturbance slopes
model_8 = lmer(regional_mean_bioarea ~ 
                            predicted_from_time + 
                            metaecosystem_type  + 
                            disturbance + 
                            (1 | system_nr),
                        data = ds_regional_predicted_shrunk_type_n_day,
                        REML = FALSE)

anova(model_5, model_8)

```

They are the same. Keep model_8.

**Do different medium-medium meta-ecosystems have different starting value (t2) at low disturbance** **(*does system number have a random effect on the intercept*)?**

```{r}

#Take off random effects
model_9 = lm(regional_mean_bioarea ~ 
                            predicted_from_time + 
                            metaecosystem_type  + 
                            disturbance,
                        data = ds_regional_predicted_shrunk_type_n_day)

anova(model_8, model_9)
```

They are the same. Keep model_9.

### Effect size of meta-ecosystem type in the best model

```{r}

best_model = model_9

summary(best_model)
#R squared: 0.795

#Take off metaecosystem type
best_model_without_metaeco_type = lm(regional_mean_bioarea ~ 
                            predicted_from_time + 
                            disturbance,
                        data = ds_regional_predicted_shrunk_type_n_day)

anova(best_model, best_model_without_metaeco_type)
#they are different.
summary(best_model_without_metaeco_type)
#R squared: 0.718

R2_metaecosystem = summary(best_model)$adj.r.squared - summary(best_model_without_metaeco_type)$adj.r.squared
R2_metaecosystem = round(R2_metaecosystem, digits = 3)
```

So, if we fit time dynamics to our data, we get an effect size of meta-ecosystem type of `r R2_metaecosystem`. That is still really low.
