---
title: "regional_biomass_model"
author: "Emanuele Giacomuzzo"
date: '2022-07-22'
output: html_document
editor_options: 
  chunk_output_type: console
---


## Regional biomass - all time points

When modelling the regional biomass, we want to understand if the regional biomass produced by an ecosystem with a small and a large patch (metaecosystem_type = S_L) is lower than the regional biomass produced by an ecosystem with two medium patches (metaecosystem_type = M_M).

### Create regional biomass data set

First of all, let's produce a data set including the regional biomass of all our meta ecosystems. In this data set, not only we want to have the regional biomass of the meta-ecosystems (averaged first across videos and then across patches) but also:

-   We want to include only the meta-ecosystems in which patches had both medium size (metaecosystem_type = M_M) and meta-ecosystems in which patches had one a small size and the other large size (metaecosystem_type = S_L).

-   We want to take off the first time point (day = 0). This is because all the meta-ecosystems had the same regional biomass, which was a construct of our experimental design.

```{r regional-biomass-modified}

ds_regional_shrunk_type_n_day = ds_regional %>%
    filter (metaecosystem_type == "M_M" | metaecosystem_type == "S_L", 
            day != 0)
```

### Model selection

First of all, let's include time as a random variable. Let's start from the largest mixed effect model makes sense to construct. This will include:

-   As fixed effect: disturbance, metaecosystem type, and their interaction
-   As random effect (random intercept and slope): day and the number of the metaecosystem (system_nr).

We are actually going to construct two full models. One with the correlated and one with the uncorrelated random slopes and intercept, the other without.

```{r full-models}

#Uncorrelated intercepts and slopes
full_model = lmer(regional_mean_bioarea ~ 
                    metaecosystem_type  + 
                    disturbance + 
                    metaecosystem_type * disturbance + 
                    (metaecosystem_type || day) + 
                    (disturbance || day) + 
                    (metaecosystem_type*disturbance  || day) + 
                    (metaecosystem_type || system_nr) + 
                    (disturbance || system_nr) + 
                    (metaecosystem_type*disturbance  || system_nr), 
                  data = ds_regional_shrunk_type_n_day, 
                  REML = FALSE)

#Correlated intercepts and slopes
full_model_correlated = lmer(regional_mean_bioarea ~ 
                               metaecosystem_type  + 
                               disturbance + 
                               metaecosystem_type * disturbance + 
                               (metaecosystem_type | day) + 
                               (disturbance | day) + 
                               (metaecosystem_type*disturbance  | day) + 
                               (metaecosystem_type | system_nr) + 
                               (disturbance | system_nr) + 
                               (metaecosystem_type*disturbance  | system_nr), 
                             data = ds_regional_shrunk_type_n_day, REML = FALSE)

anova(full_model, full_model_correlated)
```

Although the AIC for the model with correlated slopes is lower, there is not statistical significance between the two models. Let's then keep as a full model the one with non correlated slopes (full_model).

#### *Meta-ecosystem ID random effect*

Should we keep the random effect of the metaecosystem number?

```{r no_system_nr_model}

no_system_nr_model = lmer(regional_mean_bioarea ~ 
                            metaecosystem_type  + 
                            disturbance + 
                            metaecosystem_type * disturbance + 
                            (metaecosystem_type || day) + 
                            (disturbance || day) + 
                            (metaecosystem_type*disturbance || day), 
                          data = ds_regional_shrunk_type_n_day, 
                          REML = FALSE)

anova(full_model, no_system_nr_model)
```

The difference between the two doesn't seem to be significant. Therefore, let's throw out the system_nr from our model.

#### *Random effects*

Should we keep the random effects?

```{r fixed_effects_model}

fixed_effects_model = lm(regional_mean_bioarea ~ 
                           metaecosystem_type  + 
                           disturbance, 
                         data = ds_regional_shrunk_type_n_day)

anova(no_system_nr_model, fixed_effects_model)
```

The full model is better, as we expected. Time plays such an important part in explaining the way that biomass changes.

#### *Interaction between metaecosystem and disturbance*

Should we keep the interaction between metaecosystem and disturbance?

```{r no_interaction_model, message=FALSE}

no_interaction_model = lmer(regional_mean_bioarea ~ 
                              metaecosystem_type + 
                              disturbance  + 
                              (metaecosystem_type || day) + 
                              (disturbance || day), 
                            data = ds_regional_shrunk_type_n_day, 
                            REML = FALSE)

anova(no_system_nr_model, no_interaction_model)
```

There is no statistical significance between the two models. Therefore, let's drop the interaction between disturbance and meta-ecosystem type.

#### *Random slopes*

Should we keep the random slopes?

```{r no_slopes_model, message=FALSE}

no_slopes_model = lmer(regional_mean_bioarea ~ metaecosystem_type + 
                         disturbance  + 
                         (1 | day), 
                       data = ds_regional_shrunk_type_n_day, 
                       REML = FALSE)

anova(no_interaction_model, no_slopes_model)
```

Yes. We should keep the random slopes. Well, it seems like this is our best model then.

### Best model

#### Without fitting function to time dynamics

##### Effect size & significance

After model selection, we determined that the best model is the following one:

`regional_mean_bioarea ~ metaecosystem_type + disturbance + (metaecosystem_type || day) + (disturbance || day)`

coded as

`lmer(regional_mean_bioarea ~ metaecosystem_type + disturbance  + (metaecosystem_type || day) + (disturbance || day), data = ds_regional_shrunk_type_n_day, REML = FALSE)`

Let's call it then `best_model` to don't get confused.

```{r best-model}

best_model = no_interaction_model
```

###### Effect size & significance of best model

Let's now calculate the statistical significance and effect size of the best model. The marginal and conditional r squared are calculated using the package `MuMIn`. For the coding and interpretation of these r squared check the [documentation for the r.squaredGLMM function](https://rdrr.io/cran/MuMIn/man/r.squaredGLMM.html).

```{r r2-p-best-model}

model.null = lmer(regional_mean_bioarea ~ (1 | day), data = ds_regional_shrunk_type_n_day, REML = FALSE)

r2_best = r.squaredGLMM(best_model)
r2_best = round(r2_best, digits = 3)

anova = anova(best_model, model.null)
p_best = anova$`Pr(>Chisq)`[2]
p_best = round(p_best, digits = 5)

if (p_best < 0.00001) {
  p_best = "< 0.00001"
}


```

###### Effect size & significance of meta-ecosystem type (in the best model)

```{r p-r2-meta-ecosystem-type}
metaecosystem_type_null = lmer(regional_mean_bioarea ~  
                                 disturbance  + 
                                 (disturbance || day),
                               data = ds_regional_shrunk_type_n_day, 
                               REML = FALSE, 
                               control = lmerControl(optimizer ='optimx', 
                                                     optCtrl=list(method='L-BFGS-B')))

r2_no_metaecosystem_type = r.squaredGLMM(metaecosystem_type_null)
r2_no_metaecosystem_type = round(r2_no_metaecosystem_type, digits = 3)

anova = anova(best_model, metaecosystem_type_null)
p_no_metaecosystem_type = anova$`Pr(>Chisq)`[2]
p_no_metaecosystem_type = round(p_no_metaecosystem_type, digits = 5)

if (p_no_metaecosystem_type < 0.00001) {
  p_no_metaecosystem_type = "< 0.00001"
}

```

###### Effect size & significance of disturbance (in the best model)

```{r p-r2-disturbance}

disturbance_null = lmer(regional_mean_bioarea ~ 
                          metaecosystem_type  + 
                          (metaecosystem_type || day), 
                        data = ds_regional_shrunk_type_n_day, 
                        REML = FALSE,
                        control = lmerControl(optimizer ='optimx', 
                                                     optCtrl=list(method='L-BFGS-B')))

r2_no_disturbance = r.squaredGLMM(disturbance_null)
r2_no_disturbance = round(r2_no_disturbance, digits = 3)

anova = anova(best_model, disturbance_null)
p_no_disturbance = anova$`Pr(>Chisq)`[2]
p_no_disturbance = round(p_no_disturbance, digits = 5)

if (p_no_disturbance < 0.00001) {
  p_no_disturbance = "< 0.00001"
}

```

The effect size and significance of our results can be found in the following table.

| Model                                  |           Marginal R2           |   Marginal R2 of the best model explained    |         Conditional R2          |  Conditional R2 of the best model explained  |           P-value           |
|:-----------|:----------:|:----------:|:----------:|:----------:|:----------:|
| Best model                             |         `r r2_best[1]`          |                      /                       |         `r r2_best[2]`          |                      /                       |         `r p_best`          |
| Best model without meta-ecosystem type | `r r2_no_metaecosystem_type[1]` | `r r2_best[1] - r2_no_metaecosystem_type[1]` | `r r2_no_metaecosystem_type[2]` | `r r2_best[2] - r2_no_metaecosystem_type[2]` | `r p_no_metaecosystem_type` |
| Best model without disturbance         |    `r r2_no_disturbance[1]`     |    `r r2_best[1] - r2_no_disturbance[1]`     |    `r r2_no_disturbance[2]`     |    `r r2_best[2] - r2_no_disturbance[2]`     |    `r p_no_disturbance`     |

This means that meta-ecosystem type should explain more than disturbance regional biomass dynamics. However, the effect size isn't that high (`r r2_best[1] - r2_no_metaecosystem_type[1]`). Because of this, we thought we should fit a function to the time dynamics of the regional biomass.

#### Fitting function to time dynamics

Here we want to fit how biomass changes across time to a function. The biomass of our meta-ecosystems looks like this.

```{r regional biomass plot}

ds_regional_shrunk_type = ds_regional %>%
    filter(metaecosystem_type == "M_M" | metaecosystem_type == "S_L")

ds_regional_shrunk_type%>%
  ggplot(aes(x = day,
             y = regional_mean_bioarea,
             group = day)) + 
  geom_boxplot() +
  labs(x = "day", y = "regional bioarea")
```

To fit these data, we need to produce (and parameterise) a function that resemble how the biomass first increases and then decreases.

Hank produced the following function:

$$biomass = a_4 * (day - a_5) * e^{a_1(day - a_5)}$$

If we parameterise the function and then plot, it looks as follows.

```{r time-function}

a1 = -0.1
a4 = 1200
a5 = -1

day = seq(0, 30, 0.01)
biomass = a4*(day-a5) * exp(a1*(day-a5))
plot(biomass ~ day)
```

Now, let's find the best parameters (a1, a4, a5) that fit our data.

```{r parameterise-time-function}

model = nls(regional_mean_bioarea ~ a4 * (day-a5) * exp(a1 * (day-a5)), 
            start = list(a1 = -0.1, a4 = 1200, a5 = -1),
            trace = T,
            data = ds_regional_shrunk_type)

model$m$getPars()

a1 = as.numeric(model$m$getPars()[1])
a4 = as.numeric(model$m$getPars()[2])
a5 = as.numeric(model$m$getPars()[3])
```

And now let's plot the function to see how it fits our data.

```{r plot-parameterised-time-function}

day = seq(0,30,1)
predicted = a4*(day-a5)*exp(a1*(day-a5))
data_fitted=data.frame(day=day,regional_mean_bioarea=predicted)

ds_regional_shrunk_type%>%
  ggplot(aes(x = day,
             y = regional_mean_bioarea,
             group = day)) + 
  geom_boxplot() +
  labs(x = "day", y = "regional bioarea") +
  geom_line(data=data_fitted,aes(x = day, y=regional_mean_bioarea),color="red", group = 1)
```

Let's then include our predictions into the data set.

```{r predicted-ds}

ds_regional_predicted_shrunk_type = ds_regional %>%
  mutate(predicted_from_time = a4*(day-a5)*exp(a1*(day-a5))) %>%
  filter(metaecosystem_type == "S_L" | metaecosystem_type == "M_M")
```

Next step is to see when integrating time it makes sense to have meta-ecosystem ID as a random effect.

```{r time-fitted-random-effects}

ds_regional_predicted_shrunk_type_n_day = ds_regional_predicted_shrunk_type %>%
  filter(day > 0)

fitted_fixed_model = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance,
                        data = ds_regional_predicted_shrunk_type_n_day)

fitted_mixed_model = lmer(regional_mean_bioarea ~ 
                            predicted_from_time + 
                            metaecosystem_type  + 
                            disturbance + 
                            (predicted_from_time || system_nr) + 
                            (metaecosystem_type || system_nr) + 
                            (disturbance || system_nr),
                        data = ds_regional_predicted_shrunk_type_n_day,
                        REML = FALSE)

anova = anova(fitted_mixed_model, fitted_fixed_model)
anova

p = anova$`Pr(>Chisq)`[2]
p = round(p, digits = 2)
```

It seems like there is no significance between the two models (p = `r p`). Let's therefore keep the fixed effects model. Let's now see in such model what the effect of meta-ecosystem size is.

```{r predicted-biomass-from-time}

fitted_fixed_model_without_type = lm(regional_mean_bioarea ~ 
                                       predicted_from_time + 
                                       disturbance, 
                                     data = ds_regional_predicted_shrunk_type_n_day)

anova = anova(fitted_mixed_model, fitted_fixed_model_without_type)
anova

p = anova$`Pr(>Chisq)`[2]
p = round(p, digits = 2)

summary(fitted_mixed_model)
summary(fitted_fixed_model_without_type)
```

The adjusted R-squared with meta-ecosystem type is 0.80. Without 0.74.The effect size of meta-ecosystem type is only 0.06, as before.

**Therefore, fitting a function to the temporal dynamics did not increase the effect size of meta-ecosystem type.**

## Regional biomass - dropping first two time points

```{r dropping-time-points}

ds_regional_predicted_shrunk_type_day_8_28 = ds_regional_predicted_shrunk_type %>%
  filter(day >= 8, day <= 28)

#Fixed effect model with fitted time 
fixed_fitted = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          predicted_from_time * metaecosystem_type +
                          predicted_from_time * disturbance + 
                          metaecosystem_type * disturbance,
                        data = ds_regional_predicted_shrunk_type_day_8_28)

#Random effect model with fitted time: uncorrelated slopes
mixed_fitted_uncorrelated_slopes = lmer(regional_mean_bioarea ~ 
                            predicted_from_time + 
                            metaecosystem_type  + 
                            disturbance +
                            predicted_from_time * metaecosystem_type +
                            predicted_from_time * disturbance + 
                            metaecosystem_type * disturbance + 
                            (predicted_from_time || system_nr) + 
                            (metaecosystem_type || system_nr) + 
                            (disturbance || system_nr) +
                            (predicted_from_time * metaecosystem_type || system_nr)+
                            (predicted_from_time * disturbance || system_nr) + 
                            (metaecosystem_type * disturbance || system_nr),
                        data = ds_regional_predicted_shrunk_type_day_8_28,
                        REML = FALSE)

#Random effect model with fitted time: correlated slopes
mixed_fitted_correlated_slopes = lmer(regional_mean_bioarea ~ 
                            predicted_from_time + 
                            metaecosystem_type  + 
                            disturbance + 
                            (predicted_from_time | system_nr) + 
                            (metaecosystem_type | system_nr) + 
                            (disturbance | system_nr) +
                            (predicted_from_time * metaecosystem_type | system_nr) +
                            (predicted_from_time * disturbance | system_nr) + 
                            (metaecosystem_type * disturbance | system_nr),
                        data = ds_regional_predicted_shrunk_type_day_8_28,
                        REML = FALSE)

#Random effect model with fitted time: no slopes
mixed_fitted_no_slopes = lmer(regional_mean_bioarea ~ 
                              predicted_from_time + 
                              metaecosystem_type  + 
                              disturbance +
                              predicted_from_time * metaecosystem_type +
                              predicted_from_time * disturbance + 
                              metaecosystem_type * disturbance +
                              (1 | system_nr),
                        data = ds_regional_predicted_shrunk_type_day_8_28,
                        REML = FALSE)

anova(mixed_fitted_uncorrelated_slopes, mixed_fitted_correlated_slopes, mixed_fitted_no_slopes,fixed_fitted)
```

The best one is either the fixed_fitted (lower BIC) or mixed_fitted_no_slopes (lower AIC). Because I want to explain and not predict, I will keep the one with lower BIC: fixed_fitted. Let's see now if I should keep some of the interactions.

```{r}

fixed_fitted = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          predicted_from_time * metaecosystem_type + #1
                          predicted_from_time * disturbance +  #2
                          metaecosystem_type * disturbance, #3
                        data = ds_regional_predicted_shrunk_type_day_8_28)

fixed_fitted_2 = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          predicted_from_time * metaecosystem_type + #1
                          predicted_from_time * disturbance, #2
                        data = ds_regional_predicted_shrunk_type_day_8_28)

fixed_fitted_3 = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          predicted_from_time * disturbance + #2
                          metaecosystem_type * disturbance, #3
                        data = ds_regional_predicted_shrunk_type_day_8_28)

fixed_fitted_4 = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          predicted_from_time * metaecosystem_type + #1
                          metaecosystem_type * disturbance, #3
                        data = ds_regional_predicted_shrunk_type_day_8_28)

fixed_fitted_5 = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          predicted_from_time * metaecosystem_type, #1
                        data = ds_regional_predicted_shrunk_type_day_8_28)

fixed_fitted_6 = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          predicted_from_time * disturbance, #2
                        data = ds_regional_predicted_shrunk_type_day_8_28)

fixed_fitted_7 = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          metaecosystem_type * disturbance, #3
                        data = ds_regional_predicted_shrunk_type_day_8_28)

fixed_fitted_8 = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance,
                        data = ds_regional_predicted_shrunk_type_day_8_28)

AIC(fixed_fitted_8, fixed_fitted, fixed_fitted_2, fixed_fitted_3, fixed_fitted_4, fixed_fitted_5, fixed_fitted_6, fixed_fitted_7)

BIC(fixed_fitted_8, fixed_fitted, fixed_fitted_2, fixed_fitted_3, fixed_fitted_4, fixed_fitted_5, fixed_fitted_6, fixed_fitted_7)
```

It seems like the best one according to both AIC and BIC is fixed_fitted_5. Let's if there is any statistical difference with the initial model.

```{r}

anova(fixed_fitted_5, fixed_fitted)
```

There's no difference. Therefore, I will keep the fixed_fitted_5 as my best model. This is because it has less variables.

Let's now calculate then the effect size of meta-ecosystem type.

```{r}

fixed_fitted_5 = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          predicted_from_time * metaecosystem_type, #1
                        data = ds_regional_predicted_shrunk_type_day_8_28)
summary(fixed_fitted_5)

fixed_fitted_5_no_metaecosystem_type = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          disturbance,
                        data = ds_regional_predicted_shrunk_type_day_8_28)
summary(fixed_fitted_5_no_metaecosystem_type)
```

**R squared (adjusted)**

Fixed_fitted_5: 0.81

fixed_fitted_5\_no_metaecosystem_type: 0.72

So, it seems like it worked to increase the effect size to drop the first two time points.

## Regional biomass - dropping first three time points

```{r dropping-time-points}

ds_regional_predicted_shrunk_type_day_12_28 = ds_regional_predicted_shrunk_type %>%
  filter(day >= 12, day <= 28)

#Fixed effect model with fitted time 
fixed_fitted = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          predicted_from_time * metaecosystem_type +
                          predicted_from_time * disturbance + 
                          metaecosystem_type * disturbance,
                        data = ds_regional_predicted_shrunk_type_day_12_28)

#Random effect model with fitted time: uncorrelated slopes
mixed_fitted_uncorrelated_slopes = lmer(regional_mean_bioarea ~ 
                            predicted_from_time + 
                            metaecosystem_type  + 
                            disturbance +
                            predicted_from_time * metaecosystem_type +
                            predicted_from_time * disturbance + 
                            metaecosystem_type * disturbance + 
                            (predicted_from_time || system_nr) + 
                            (metaecosystem_type || system_nr) + 
                            (disturbance || system_nr) +
                            (predicted_from_time * metaecosystem_type || system_nr)+
                            (predicted_from_time * disturbance || system_nr) + 
                            (metaecosystem_type * disturbance || system_nr),
                        data = ds_regional_predicted_shrunk_type_day_12_28,
                        REML = FALSE)

#Random effect model with fitted time: correlated slopes
mixed_fitted_correlated_slopes = lmer(regional_mean_bioarea ~ 
                            predicted_from_time + 
                            metaecosystem_type  + 
                            disturbance + 
                            (predicted_from_time | system_nr) + 
                            (metaecosystem_type | system_nr) + 
                            (disturbance | system_nr) +
                            (predicted_from_time * metaecosystem_type | system_nr) +
                            (predicted_from_time * disturbance | system_nr) + 
                            (metaecosystem_type * disturbance | system_nr),
                        data = ds_regional_predicted_shrunk_type_day_12_28,
                        REML = FALSE)

#Random effect model with fitted time: no slopes
mixed_fitted_no_slopes = lmer(regional_mean_bioarea ~ 
                              predicted_from_time + 
                              metaecosystem_type  + 
                              disturbance +
                              predicted_from_time * metaecosystem_type +
                              predicted_from_time * disturbance + 
                              metaecosystem_type * disturbance +
                              (1 | system_nr),
                        data = ds_regional_predicted_shrunk_type_day_12_28,
                        REML = FALSE)

anova(mixed_fitted_uncorrelated_slopes, mixed_fitted_correlated_slopes, mixed_fitted_no_slopes,fixed_fitted)
```

The best one is either the fixed_fitted (lower BIC) or mixed_fitted_no_slopes (lower AIC). Because I want to explain and not predict, I will keep the one with lower BIC: fixed_fitted. Let's see now if I should keep some of the interactions.

```{r}

fixed_fitted = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          predicted_from_time * metaecosystem_type + #1
                          predicted_from_time * disturbance +  #2
                          metaecosystem_type * disturbance, #3
                        data = ds_regional_predicted_shrunk_type_day_12_28)

fixed_fitted_2 = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          predicted_from_time * metaecosystem_type + #1
                          predicted_from_time * disturbance, #2
                        data = ds_regional_predicted_shrunk_type_day_12_28)

fixed_fitted_3 = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          predicted_from_time * disturbance + #2
                          metaecosystem_type * disturbance, #3
                        data = ds_regional_predicted_shrunk_type_day_12_28)

fixed_fitted_4 = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          predicted_from_time * metaecosystem_type + #1
                          metaecosystem_type * disturbance, #3
                        data = ds_regional_predicted_shrunk_type_day_12_28)

fixed_fitted_5 = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          predicted_from_time * metaecosystem_type, #1
                        data = ds_regional_predicted_shrunk_type_day_12_28)

fixed_fitted_6 = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          predicted_from_time * disturbance, #2
                        data = ds_regional_predicted_shrunk_type_day_12_28)

fixed_fitted_7 = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          metaecosystem_type * disturbance, #3
                        data = ds_regional_predicted_shrunk_type_day_12_28)

fixed_fitted_8 = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance,
                        data = ds_regional_predicted_shrunk_type_day_12_28)

BIC(fixed_fitted_8, fixed_fitted, fixed_fitted_2, fixed_fitted_3, fixed_fitted_4, fixed_fitted_5, fixed_fitted_6, fixed_fitted_7)
```

**I'm not sure here. Just to make it easier I will keep the same model as before to be able to compare.**

Let's now calculate then the effect size of meta-ecosystem type.

```{r}

fixed_fitted_5 = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          predicted_from_time * metaecosystem_type, #1
                        data = ds_regional_predicted_shrunk_type_day_12_28)
summary(fixed_fitted_5)

fixed_fitted_5_no_metaecosystem_type = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          disturbance,
                        data = ds_regional_predicted_shrunk_type_day_12_28)
summary(fixed_fitted_5_no_metaecosystem_type)
```

**R squared (adjusted)**

Fixed_fitted_5: 0.82

fixed_fitted_5\_no_metaecosystem_type: 0.72

Maybe if only I selected the right model...

According to BIC the best model was fixed_fitted_2. Therefore, I will recalculate the effect size here:

```{r}

fixed_fitted_2 = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          predicted_from_time * metaecosystem_type + #1
                          predicted_from_time * disturbance, #2
                        data = ds_regional_predicted_shrunk_type_day_12_28)
summary(fixed_fitted_2)

fixed_fitted_2_no_metaecosystem_type = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          disturbance +
                          predicted_from_time * disturbance, #2
                        data = ds_regional_predicted_shrunk_type_day_12_28)
summary(fixed_fitted_2_no_metaecosystem_type)
```

**R squared (adjusted)**

fixed_fitted_2: 0.83

fixed_fitted_2\_no_metaecosystem_type: 0.70

Well, that's cool. We doubled the effect size.

## Regional biomass - strongest time point

I can't include system_nr as random variable as I have only one data point per system_nr.

```{r dropping-time-points}

ds_regional_predicted_shrunk_type_day_12 = ds_regional_predicted_shrunk_type %>%
  filter(day == 12)

#Fixed effect model with fitted time 
fixed_fitted = lm(regional_mean_bioarea ~ 
                          metaecosystem_type  + 
                          disturbance +
                          metaecosystem_type * disturbance,
                        data = ds_regional_predicted_shrunk_type_day_12)

fixed_fitted_2 = lm(regional_mean_bioarea ~ 
                          metaecosystem_type  + 
                          disturbance,
                        data = ds_regional_predicted_shrunk_type_day_12)
anova(fixed_fitted, fixed_fitted_2)
```

Let's get rid of the interaction.

```{r}

summary(fixed_fitted_2)

fixed_fitted_2_no_metaecosystem_type = lm(regional_mean_bioarea ~ 
                          disturbance,
                        data = ds_regional_predicted_shrunk_type_day_12)
summary(fixed_fitted_2_no_metaecosystem_type)
```

**R squared (adjusted)**

Fixed_fittted_2: 0.75

fixed_fitted_2\_no_metaecosystem_type: 0.23

Great! So, if we just keep this data point, the effect size of meta-ecosystem type would be 0.52.

Model diagnostics:

```{r}

par(mfrow=c(2,3))
plot(fixed_fitted_2, which = 1:5)
plot(fixed_fitted_2_no_metaecosystem_type, which = 1:5)
```
