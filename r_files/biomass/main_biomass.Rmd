---
title: "Biomass analysis (PatchSizePilot)"
author: "Emanuele Giacomuzzo"
date: '2022-07-07'
output: html_document
editor_options: 
  chunk_output_type: console
bibliography: /Applications/Mendeley/library.bib
---

### Aim

Here I study how **biomass density** changes across treatments in the PatchSizePilot. In particular, my research questions are:

-   How does biomass density change **regionally**?

    -   Do meta-ecosystems with the same total size but with patches that are either the same size or of different size have a different biomass density? *(Do the medium-medium and small-large meta-ecosystems have different biomass density?)*

    -   And if they do, is it because of resource flow? Or would we see this also with small and large ecosystems that are not connected? *(Do the small-large meta-ecosystems have different biomass density from two isolated small and large patches?)*

<!-- -->

-   How does biomass density change **locally**?
    -   How does biomass density change according to the size to which the patch is connected? *(Does a small patch connected to a small patch have the same biomass density than a small patch connected to a large patch? And does a large patch connected to a large patch have the same biomass density than a large patch connected to a small patch?)*

### Data

```{r child = here("r_files", "biomass", "sections", "data_manipulation.Rmd")}
source(here("r_files", "biomass", "extracted_sections", "data_manipulation.R"))
```

### Regional biomass {.tabset .tabset-dropdown}

#### Medium-Medium vs Small-Large {.tabset .tabset-pills}

Do meta-ecosystems with the same total size but with patches that are either the same size or of different size have a different biomass density? *(Do the medium-medium and small-large meta-ecosystems have different biomass density?)*

##### Plots

```{r child = here("r_files", "biomass", "sections", "MM_SL_plots.Rmd")}
source(here("r_files", "biomass", "extracted_sections", "MM_SL_plots.R"))
```

##### Model time series {.tabset .tabset-pills}

How does the biomass density of medium-medium and small-large meta-ecosystems differ across the time series? *(The first two points before the first disturbance are taken off).*

```{r child = here("r_files", "biomass", "sections", "MM_SL_time_series.Rmd")}
source(here("r_files", "biomass", "extracted_sections", "MM_SL_time_series.R"))
```

##### Model single points

How does the biomass density of medium-medium and small-large meta-ecosystems differ for each time point? *(The first two points before the first disturbance are taken off).*

```{r MM_SL_time_fitted, child = here("r_files", "biomass", "sections", "MM_SL_single_points.Rmd"), echo = TRUE, eval = TRUE}
source(here("r_files", "biomass", "extracted_sections", "MM_SL_single_points.R"))
```

#### Small-Large vs Small-Large from isolated {.tabset .tabset-pills}

Do a meta-ecosystem with patches of the same size and a meta-ecosystems with patches of different size have different regional biomass density because of their resource flow? Or would we see this also with small and large ecosystems that are not connected? *(Do the small-large meta-ecosystems have different biomass density from two isolated small and large patches?)*

```{r child = here("r_files", "biomass", "sections", "SL_SL_from_isolated.Rmd")}
source(here("r_files", "biomass", "extracted_sections", "SL_SL_from_isolated.R"))
```

#### Meta-ecosystems of different total size

How does the biomass density of meta-ecosystems change according to the size of their patches?

```{r child = here("r_files", "biomass", "sections", "metaecos_of_different_size.Rmd")}
source(here("r_files", "biomass", "extracted_sections", "metaecos_of_different_size.R"))
```

### Local biomass {.tabset .tabset-dropdown}

#### Tidy

First of all, let's create a data-set with the ln response ratio of all patches compared to their isolated counterpart.

```{r created-averaged-lnRR-ds}
for (disturbance_input in c("low", "high")){
  for (eco_metaeco_input in c("S", "M", "L")){
    for (time_point_input in 0:7){
      
      ds_biomass$isolated_control[ds_biomass$patch_size == eco_metaeco_input & 
                              ds_biomass$disturbance == disturbance_input &
                              ds_biomass$time_point == time_point_input] = 
        
        ds_biomass %>%
        filter(disturbance == disturbance_input) %>%
        filter(eco_metaeco_type == eco_metaeco_input) %>%
        filter(time_point == time_point_input) %>%        
        group_by(culture_ID) %>%
        summarise(bioarea_per_volume_across_videos = mean(bioarea_per_volume)) %>%
        summarise(mean_bioarea_per_volume = mean(bioarea_per_volume_across_videos))
      
    }
  }
}

ds_biomass_averaged_across_videos =  ds_biomass %>%
  mutate(isolated_control = as.numeric(isolated_control)) %>%
  group_by(disturbance, 
           eco_metaeco_type, 
           culture_ID, 
           day,
           time_point,
           isolated_control) %>%
  summarise(bioarea_per_volume_across_videos = mean(bioarea_per_volume)) %>% #Across videos
  mutate(RR_bioarea_per_volume = (bioarea_per_volume_across_videos+1) /isolated_control) %>%
  mutate(lnRR_bioarea_per_volume = ln(RR_bioarea_per_volume))
```

#### Small patches {.tabset .tabset-pills}

How does biomass density change according to the size to which the patch is connected? *(Does a small patch connected to a small patch have the same biomass density than a small patch connected to a large patch?)*

```{r child = here("r_files", "biomass", "sections", "small_patches.Rmd")}
source(here("r_files", "biomass", "extracted_sections", "small_patches.R"))
```

#### Large patches {.tabset .tabset-pills}

How does biomass density change according to the size to which the patch is connected? *(Does a large patch connected to a large patch have the same biomass density than a large patch connected to a small patch?)*

```{r child = here("r_files", "biomass", "sections", "large_patches.Rmd")}
source(here("r_files", "biomass", "extracted_sections", "large_patches.R"))
```

#### Isolated patches

How does biomass density change according to the size of isolated patches? *(How does the biomass of small, medium, and large patches change?)*

```{r child = here("r_files", "biomass", "sections", "isolated_patches.Rmd")}
source(here("r_files", "biomass", "extracted_sections", "isolated_patches.R"))
```

### Evaporation

Was the amount of evaporation different across different treatments and time points?

```{r child = here("r_files", "biomass", "sections", "evaporation.Rmd"), eval= TRUE}
source(here("r_files", "biomass", "extracted_sections", "evaporation.R"))
```
