---
title: "gifs"
author: "Emanuele Giacomuzzo"
date: "2022-09-08"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r fig.align='center'}
#Takes about 7 minutes to run 

start = Sys.time()
p = list()
n = 0
first_level = c(
  "Small connected to large",
  "Small connected to large",
  "Large connected to large",
  "Large connected to large"
)
second_level = c(
  "Small connected to small",
  "Small connected to small",
  "Large connected to small",
  "Large connected to small"
)

for (patch_size_input in c("S", "L")) {
  for (disturbance_input in c("low", "high")) {
    n = n + 1
    
    title = paste0("Day: {round(frame_time, digits = 0)} ",
                   "(Disturbance = ",
                   disturbance_input,
                   ")")
    
    p[[n]] <- ds_classes_averaged %>%
      filter(disturbance == disturbance_input) %>%
      filter(patch_size == patch_size_input) %>%
      filter(!eco_metaeco_type == patch_size_input) %>%
      ggplot(
        aes(
          x = log_size_class,
          y = log_abundance,
          group = interaction(log_size_class, eco_metaeco_type),
          color = eco_metaeco_type
        )
      ) +
      geom_point(stat = "summary", fun = "mean") +
      geom_line(stat = "summary",
                fun = "mean",
                aes(group = eco_metaeco_type)) +
      geom_errorbar(
        aes(ymax = log_abundance_upper_ci,
            ymin = log_abundance_lower_ci),
        width = .2,
        position = position_dodge(0.05)
      ) +
      scale_color_manual(
        values = c(colour_different_size, colour_same_size),
        labels = c(first_level[n],
                                    second_level[n])) +
      theme_bw() +
      theme(
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = c(.95, .95),
        legend.justification = c("right", "top"),
        legend.box.just = "right",
        legend.margin = margin(6, 6, 6, 6)
      ) +
      labs(
        title = title,
        x = 'Log size (μm2)',
        y = 'Log abundance + 1 (indiv/μm2)',
        color = ""
      ) +
      transition_time(day) +
      ease_aes('linear')
    
    animate(
      p[[n]],
      duration = 20,
      fps = 25,
      width = publication_width,
      height = publication_height,
      units = publication_unit,
      res = 150,
      renderer = gifski_renderer()
    )
    
    file_name = paste0("transition_day_",
                       patch_size_input,
                       "_",
                       disturbance_input,
                       ".gif")
    anim_save(here("gifs", file_name))
    
  }
}

end = Sys.time()
running_time = end - start
```