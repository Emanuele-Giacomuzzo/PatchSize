---
title: "overview"
author: "Emanuele Giacomuzzo"
date: "2022-08-18"
output: html_document
---

### Recap

Meta-ecosystems have been studied looking at meta-ecosystems in which patch size was the same. However, of course, we know that meta-ecosystems are mad out of patches that have different size. To see the effects of patch size on meta-ecosystem properties, we ran a four weeks protist experiment in which different ecosystems were connected through the flow of nutrients. The flow of nutrients resulted from a perturbation of the ecosystems in which a fixed part of the cultures was boiled and then poored into the receiving patch. This had a fixed volume (e.g., small perturbation = 6.75 ml) and was the same across all patch sizes. The experiment design consisted in crossing two disturbances with a small, medium, and large isolated ecosystems and with a small-small, medium-medium, large-large, and small-large meta-ecosystem. We took videos every four days and we create this perturbation and resource flow the day after taking videos. We skipped the perturbation the day after we assembled the experiment so that we would start perturbing it when population densities were already high.

We had mainly two research questions:

-   Do patch properties of a patch depend upon the size of the patch it is connected to?

-   Do metaecosystem properties of a meta-ecosystem depend upon the relative size of its patch?

### Design

![](images/paste-58F5AC73.png)

### Lab work

#### Creation of high-density monocultures

23/3/22 PPM for increasing the number of monocultures in the collection.

24/3/22 Collection control. See monoculture maintenance lab book p. 47.

26/3/22 Increase of number of monocultures in the collection. To do so, take the best culture and make 3 new ones. See monoculture maintenance lab book p. 47.

1/4/22 Make PPM for high density monocultures. See PatchSizePilot lab book p. 5.

3/4/22 Make bacterial solution for high density monocultures. See PatchSizePilot lab book p. 8.

5/4/22 Grow high density monocultures. Make 3 high density monocultures for each protist species with 200 ml with 5% bacterial solution, 85% PPM, 10% protists, and 2 seeds. See PatchSizePilot lab book p. 10

10/4/2022 Check high density monocultures. Cep, Eup, Spi, Spi te were really low.

13/4/2022 Start of the experiment. See PatchSizePilot p. 33.

#### Things I could have done better

\- Autoclave all the material in advance

\- Get more high-density monocultures

\- Decide in advance the days in which you are going to check the high-density monocultures and prepare bacteria in advance for that day so that if some of them crashed you are still on time to make new ones.

\- Use a single lab book for also when you create PPM and check the collection.

\- Make a really high amount of PPM, as you will need for so many different things (\>10 L). Maybe also autoclave 1 L Schott bottles so that you don't have to oxygenate whole 5 L bottles of PPM. I think that I should have maybe made even a 10 L bottle of PPM.

\- According to Silvana protists take 4-7 days to grow. The fastest is Tet (ca 4 days) and the slowest is Spi (ca 7 days). Once that you grow them they should stay at carrying capacity for a bit of time I guess, as you can see in the monoculture collection. I should make sure I'm growing them in the right way. I think that maybe I should grow them 10 days in advance so that I could actually grow also the slow species if they crashed. What should I do if all of them crashed?

### Mixed effects models

-   To build the mixed effect models we will use the R package lme4. See page 6 of [this PDF](https://cran.r-project.org/web/packages/lme4/vignettes/lmer.pdf) to know more about the syntaxis of this package and [this link](https://mspeekenbrink.github.io/sdam-r-companion/linear-mixed-effects-models.html) for the interaction syntaxis.

-   To do model diagnostics of mixed effect models, I'm going to look at the following two plots (as suggested by @Zuur2009, page 487):

    -   Quantile-quantile plots (`plot(mixed_model)`)

    -   Partial residual plots (`qqnorm(resid(mixed_model))`)

-   The effect size of the explaining variables is calculated in the mixed effect models as marginal and conditional r squared. The marginal r squared is how much variance is explained by the fixed effects. The conditional r squared is how much variance is explained by the fixed and the random effects. The marginal and conditional r squared are calculated using the package `MuMIn`. The computation is based on the methods of @Nakagawa2017. For the coding and interpretation of these r squared check the [documentation for the r.squaredGLMM function](https://rdrr.io/cran/MuMIn/man/r.squaredGLMM.html)

-   Time can be included as a fixed or random effect. Time can be included as a random effect if the different data points are non independent from each other (e.g., seasons). However, because the biomass in our experiment was following a temporal trend, the different time points show autocorrelation. In other words, t2 is more similar to t3 than t4 and so on. This is why we decided to include time as a fixed effect. For an excellent discussion on this topic see [this blog post](https://dynamicecology.wordpress.com/2015/11/04/is-it-a-fixed-or-random-effect/).

### Modeling choices

-   Interactions (here refers to how biomass changes across different patch types, but it's the same for meta-ecosystem type and other response variables)

    -   Day \* Patch Type = biomass changes in different ways in different ecosystem types. Yes.

    -   Day \* Disturbance = disturbance has a different effect at different days. Yes.

    -   Patch Type \* Disturbance = disturbance has a different effect on different patch types. Yes.

-   I am going to select the best model according to AIC. @Halsey2019 suggests this approach instead of p values. P-values are not a reliable way of choosing a model because:

    -   My sample size is small, producing larger p-values

    -   P-values are really variable, creating many false positives and negatives (e.g., if p=0.05 there is a 1 in 3 chance that it's a false positive)

-   To study the patch biomass how it changes across treatments, we could have made three different models between the three combinations of small patches. However, that might be confusing to interpret the results. We decided instead to use an effect size where we control is the isolated small patch. At the beginning we thought to use the natural logarithm of the response ratio (lnRR). The problem, however, is that some bioarea values were 0. We were thinking to add 1 to all null values, but according to @Rosenberg2013, such practice inflates effect sizes. Because of this, I looked into other types of effect size. I found that the most common and preferred metric in use today is known as Hedge's d (a.k.a. Hedge's g) (@Hedges1985 ). It is calculated as the difference in mean between treatment and control divided by the standard deviation of the pooled data. Another measure would be Cohen's d, but it underperforms with sample sizes that are lower than 20 ([StatisticsHowTo)](https://www.statisticshowto.com/hedges-g/). I can easily calculate the Hedge's d using the r package `effsize`.\
    Same thing for the large patches.

-   Single time points cannot be computed for effect sizes just because I have a single data point as response variable (e.g., one for S (S_S) at low disturbance at time point = 2). It would have been nice to show the difference in treatments at specific time points visually through confidence intervals. However, the confidence interval cannot be computed for the last two time points because there are too many zeros and their confidence interval computation produces a lot of Nan, Inf, and -Inf. At this point it doesn't make sense to show just a subset of time points and we decided to opt out from the visualisation of confidence intervals.

### CI

#### 95% confidence interval of means

To calcula the 95% CI of the abundance of different size classes I used the following code: <https://stackoverflow.com/questions/35953394/calculating-length-of-95-ci-using-dplyr>, whose formula can be found here: <https://courses.lumenlearning.com/introstats1/chapter/a-single-population-mean-using-the-student-t-distribution/>

$$
CI_{lower} = mean - (t \: score * \frac{SD}{sample \: size})
$$ $$
CI_{upper} = mean + (t \: score * \frac{SD}{sample \: size})
$$

where the t-score is computed from the student t distribution using the r function qt with percentile = 0.975 and degrees of freedom = sample size - 1.

#### 95% confidence interval of Hedge's d (aka Hedge's g)

Hedge's d ± 95 CI = d ± 1.96\*SE

See [HEDGES G CONFIDENCE LIMIT (nist.gov)](https://www.itl.nist.gov/div898/software/dataplot/refman1/auxillar/hedges_g.htm), [meta analysis - Calculate effect size and confidence interval from published means±std - Cross Validated (stackexchange.com)](https://stats.stackexchange.com/questions/460367/calculate-effect-size-and-confidence-interval-from-published-means%C2%B1std).

$$
SE_g = \sqrt{V_g}
$$

$$
V_g = J^2 * V_d
$$

$$
J = 1 - \frac{3}{4df-1}
$$

$$
V_d = \frac{n1 + n2}{n_1 n_2} + \frac{d^2}{2(n_1 + n_2)}
$$

d = Hedge's d

n1 = sample size of group 1

n2 = sample size of group 2

df = degrees of freedom (df = n1 + n2 - 2)

See <https://www.meta-analysis.com/downloads/Meta-analysis%20Effect%20sizes%20based%20on%20means.pdf>

### Model testing

According to this [post on stackoverflow](https://stackoverflow.com/questions/40729701/how-to-use-formula-in-r-to-exclude-main-effect-but-retain-interaction){.uri} it's not possible to build a model where there is the interaction between a factor and a continuous variable with having the factor as main variable. This is because of the function `model.matrix.default`. Therefore, I'm going to test the effects of day by taking off also the interaction term between `day` and `eco_metaeco_type`.

### Size distribution

I thought I might look into how to better choose the nr of size classes. In @Loder1997 it says that they have no idea how to do that. I will then just look into how to best choose the number of histragram plots.

### Evenness

For calculating evenness I used the following resource: [diversity-vegan.pdf (r-project.org)](https://cran.r-project.org/web/packages/vegan/vignettes/diversity-vegan.pdf)
