---
title: "fitting_dropping_first_two_time_points"
author: "Emanuele Giacomuzzo"
date: '2022-07-22'
output: html_document
---


## Regional biomass - dropping first two time points

```{r dropping-time-points}

ds_regional_predicted_shrunk_type_day_8_28 = ds_regional_predicted_shrunk_type %>%
  filter(day >= 8, day <= 28)

#Fixed effect model with fitted time 
fixed_fitted = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          predicted_from_time * metaecosystem_type +
                          predicted_from_time * disturbance + 
                          metaecosystem_type * disturbance,
                        data = ds_regional_predicted_shrunk_type_day_8_28)

#Random effect model with fitted time: uncorrelated slopes
mixed_fitted_uncorrelated_slopes = lmer(regional_mean_bioarea ~ 
                            predicted_from_time + 
                            metaecosystem_type  + 
                            disturbance +
                            predicted_from_time * metaecosystem_type +
                            predicted_from_time * disturbance + 
                            metaecosystem_type * disturbance + 
                            (predicted_from_time || system_nr) + 
                            (metaecosystem_type || system_nr) + 
                            (disturbance || system_nr) +
                            (predicted_from_time * metaecosystem_type || system_nr)+
                            (predicted_from_time * disturbance || system_nr) + 
                            (metaecosystem_type * disturbance || system_nr),
                        data = ds_regional_predicted_shrunk_type_day_8_28,
                        REML = FALSE)

#Random effect model with fitted time: correlated slopes
mixed_fitted_correlated_slopes = lmer(regional_mean_bioarea ~ 
                            predicted_from_time + 
                            metaecosystem_type  + 
                            disturbance + 
                            (predicted_from_time | system_nr) + 
                            (metaecosystem_type | system_nr) + 
                            (disturbance | system_nr) +
                            (predicted_from_time * metaecosystem_type | system_nr) +
                            (predicted_from_time * disturbance | system_nr) + 
                            (metaecosystem_type * disturbance | system_nr),
                        data = ds_regional_predicted_shrunk_type_day_8_28,
                        REML = FALSE)

#Random effect model with fitted time: no slopes
mixed_fitted_no_slopes = lmer(regional_mean_bioarea ~ 
                              predicted_from_time + 
                              metaecosystem_type  + 
                              disturbance +
                              predicted_from_time * metaecosystem_type +
                              predicted_from_time * disturbance + 
                              metaecosystem_type * disturbance +
                              (1 | system_nr),
                        data = ds_regional_predicted_shrunk_type_day_8_28,
                        REML = FALSE)

anova(mixed_fitted_uncorrelated_slopes, mixed_fitted_correlated_slopes, mixed_fitted_no_slopes,fixed_fitted)
```

The best one is either the fixed_fitted (lower BIC) or mixed_fitted_no_slopes (lower AIC). Because I want to explain and not predict, I will keep the one with lower BIC: fixed_fitted. Let's see now if I should keep some of the interactions.

```{r}

fixed_fitted = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          predicted_from_time * metaecosystem_type + #1
                          predicted_from_time * disturbance +  #2
                          metaecosystem_type * disturbance, #3
                        data = ds_regional_predicted_shrunk_type_day_8_28)

fixed_fitted_2 = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          predicted_from_time * metaecosystem_type + #1
                          predicted_from_time * disturbance, #2
                        data = ds_regional_predicted_shrunk_type_day_8_28)

fixed_fitted_3 = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          predicted_from_time * disturbance + #2
                          metaecosystem_type * disturbance, #3
                        data = ds_regional_predicted_shrunk_type_day_8_28)

fixed_fitted_4 = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          predicted_from_time * metaecosystem_type + #1
                          metaecosystem_type * disturbance, #3
                        data = ds_regional_predicted_shrunk_type_day_8_28)

fixed_fitted_5 = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          predicted_from_time * metaecosystem_type, #1
                        data = ds_regional_predicted_shrunk_type_day_8_28)

fixed_fitted_6 = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          predicted_from_time * disturbance, #2
                        data = ds_regional_predicted_shrunk_type_day_8_28)

fixed_fitted_7 = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          metaecosystem_type * disturbance, #3
                        data = ds_regional_predicted_shrunk_type_day_8_28)

fixed_fitted_8 = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance,
                        data = ds_regional_predicted_shrunk_type_day_8_28)

AIC(fixed_fitted_8, fixed_fitted, fixed_fitted_2, fixed_fitted_3, fixed_fitted_4, fixed_fitted_5, fixed_fitted_6, fixed_fitted_7)

BIC(fixed_fitted_8, fixed_fitted, fixed_fitted_2, fixed_fitted_3, fixed_fitted_4, fixed_fitted_5, fixed_fitted_6, fixed_fitted_7)
```

It seems like the best one according to both AIC and BIC is fixed_fitted_5. Let's if there is any statistical difference with the initial model.

```{r}

anova(fixed_fitted_5, fixed_fitted)
```

There's no difference. Therefore, I will keep the fixed_fitted_5 as my best model. This is because it has less variables.

Let's now calculate then the effect size of meta-ecosystem type.

```{r}

fixed_fitted_5 = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          metaecosystem_type  + 
                          disturbance +
                          predicted_from_time * metaecosystem_type, #1
                        data = ds_regional_predicted_shrunk_type_day_8_28)
summary(fixed_fitted_5)

fixed_fitted_5_no_metaecosystem_type = lm(regional_mean_bioarea ~ 
                          predicted_from_time + 
                          disturbance,
                        data = ds_regional_predicted_shrunk_type_day_8_28)
summary(fixed_fitted_5_no_metaecosystem_type)
```

**R squared (adjusted)**

Fixed_fitted_5: 0.81

fixed_fitted_5\_no_metaecosystem_type: 0.72

So, it seems like it worked to increase the effect size to drop the first two time points.