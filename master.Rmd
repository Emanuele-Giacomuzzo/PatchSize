---
html_document:
  toc: yes
  toc_float: yes
  code_folding: hide
  number_sections: yes
  includes:
    after_body: "tabset-dropdown.html"
author: "Emanuele Giacomuzzo"
date: "`r format(Sys.time(), '%Y-%m-%d %H:%M')`"
output:
  html_document:
    code_folding: hide
    profiling: yes
bibliography: library.bib
title: "ecosystemSize"
editor_options:
  chunk_output_type: console
---

```{r echo=FALSE}
disturbance_global_input = "low"
print(paste("!!", disturbance_global_input, "!!", "The experiment investigate the effects of two disturbance levels: low and high. To make it easier to interpet, we showcase only one of the two disturbance levels. In this document we showcase only the", disturbance_global_input, "disturbance)"))
```

```{r child = here::here("3_r_files", "set_packages.Rmd"), echo = FALSE, message = FALSE, cache = FALSE, autodep = FALSE}
```

```{r child = here("3_r_files", "set_functions.Rmd"), echo=FALSE}
```

#  {.tabset}

## Design {.tabset .tabset-pills}

```{r child = here("3_r_files", "design.Rmd")}
```

## Parameters

```{r child = here("3_r_files", "set_parameters.Rmd"), class.source = 'fold-show'}
```

## Data {.tabset .tabset-dropdown}

```{r child = here("3_r_files", "ds_ecosystems_info.Rmd")}
```

```{r child = here("3_r_files", "ds_individuals.Rmd")}
```

```{r child = here("3_r_files", "ds_ecosystems.Rmd")}
```

```{r child = here("3_r_files", "ds_ecosystems_effect_size.Rmd")}
```

```{r child = here("3_r_files", "ds_metaecos_1_ecosystem_combinations.Rmd")}
```

```{r child = here("3_r_files", "ds_metaecos_2_ecosystem_combination_sets.Rmd")}
```

```{r child = here("3_r_files", "ds_metaecos_3_finish.Rmd")}
```

```{r child = here("3_r_files", "ds_classes.Rmd"), eval = FALSE}
```

```{r child = here("3_r_files", "ds_classes_effect_size.Rmd"), eval = FALSE}
```

```{r echo=FALSE, message=FALSE}
save.image(file = here("4_environments", "before.RData"))
```

### Analysis both disturbances

```{r}
response_variable = "mean_shannon"
response_variable
```

```{r child = here("3_r_files", "both_disturbances_analysis.Rmd")}
```

```{r child = here("3_r_files", "ds_all_filtered.Rmd")}
```

## Plots & Analysis {.tabset .tabset-dropdown}

### All meta-ecosystems {.tabset .tabset-pills}

```{r}
metaecosystem_type_i = c("Small-Small meta-ecosystem",
                         "Medium-Medium meta-ecosystem",
                         "Medium-Medium unconnected",
                         "Large-Large meta-ecosystem",
                         "Small-Large meta-ecosystem",
                         "Small-Large unconnected")
```

#### Alpha {.tabset .tabset-pills}

```{r}
response_variable = "mean_shannon"
```

```{r child = here("3_r_files", "analysis_metaeco_variable_all.Rmd")}
```

#### Beta {.tabset .tabset-pills}

```{r}
response_variable = "bray_curtis"
```

```{r child = here("3_r_files", "analysis_metaeco_variable_all.Rmd")}
```

#### Gamma {.tabset .tabset-pills}

```{r}
response_variable = "metaecosystem_richness"
```

```{r child = here("3_r_files", "analysis_metaeco_variable_all.Rmd")}
```

#### Biomass {.tabset .tabset-pills}

```{r}
response_variable = "total_metaecosystem_bioarea_mm2"
```

```{r child = here("3_r_files", "analysis_metaeco_variable_all.Rmd")}
```

### SL vs MM {.tabset .tabset-pills}


#### Alpha {.tabset .tabset-pills}

```{r}
response_variable = "mean_shannon"
```

```{r}
metaecosystem_type_i = c("Medium-Medium meta-ecosystem",
                         "Medium-Medium unconnected",
                         "Small-Large meta-ecosystem",
                         "Small-Large unconnected")
```

```{r child = here("3_r_files", "analysis_metaeco_variable_all.Rmd")}
```

<br>

Following the initial inspection, we proceed to analyse differences among meta-ecosystems. To make it easier to interpret differences, we decided to construct a model for each comparisons we are interested in, which are: asymmetric vs symmetric connected, asymmetric connected vs unconnected, and symmetric connected vs unconnected. 

##### Holistic

```{r child = here("3_r_files", "holistic_model_metaecosystems.Rmd")}
```

##### SL {.tabset .tabset-pills}

```{r}
metaecosystem_type_i = c("Small-Large meta-ecosystem",
                         "Small-Large unconnected")
```

```{r child = here("3_r_files", "analysis_metaeco_connection.Rmd")}
```

##### MM {.tabset .tabset-pills}

```{r}
metaecosystem_type_i = c("Medium-Medium meta-ecosystem",
                         "Medium-Medium unconnected")
```

```{r child = here("3_r_files", "analysis_metaeco_connection.Rmd")}
```

<br>

Following the initial inspection, we proceed to analyse differences among meta-ecosystems. To make it easier to interpret differences, we decided to construct a model for each comparisons we are interested in, which are: asymmetric vs symmetric connected, asymmetric connected vs unconnected, and symmetric connected vs unconnected. 

#### Beta {.tabset .tabset-pills}

```{r}
response_variable = "bray_curtis"
```

```{r}
metaecosystem_type_i = c("Medium-Medium meta-ecosystem",
                         "Medium-Medium unconnected",
                         "Small-Large meta-ecosystem",
                         "Small-Large unconnected")
```

```{r child = here("3_r_files", "analysis_metaeco_variable_all.Rmd")}
```

##### Holistic

```{r child = here("3_r_files", "holistic_model_metaecosystems.Rmd")}
```

##### SL {.tabset .tabset-pills}

```{r}
metaecosystem_type_i = c("Small-Large meta-ecosystem",
                         "Small-Large unconnected")
```

```{r child = here("3_r_files", "analysis_metaeco_connection.Rmd")}
```

##### MM {.tabset .tabset-pills}

```{r}
metaecosystem_type_i = c("Medium-Medium meta-ecosystem",
                         "Medium-Medium unconnected")
```

```{r child = here("3_r_files", "analysis_metaeco_connection.Rmd")}
```

<br>

Following the initial inspection, we proceed to analyse differences among meta-ecosystems. To make it easier to interpret differences, we decided to construct a model for each comparisons we are interested in, which are: asymmetric vs symmetric connected, asymmetric connected vs unconnected, and symmetric connected vs unconnected. 

#### Gamma {.tabset .tabset-pills}

```{r}
response_variable = "metaecosystem_richness"
```

```{r}
metaecosystem_type_i = c("Medium-Medium meta-ecosystem",
                         "Medium-Medium unconnected",
                         "Small-Large meta-ecosystem",
                         "Small-Large unconnected")
```

```{r child = here("3_r_files", "analysis_metaeco_variable_all.Rmd")}
```

##### Holistic

```{r child = here("3_r_files", "holistic_model_metaecosystems.Rmd")}
```

##### SL {.tabset .tabset-pills}

```{r}
metaecosystem_type_i = c("Small-Large meta-ecosystem",
                         "Small-Large unconnected")
```

```{r child = here("3_r_files", "analysis_metaeco_connection.Rmd")}
```

##### MM {.tabset .tabset-pills}

```{r}
metaecosystem_type_i = c("Medium-Medium meta-ecosystem",
                         "Medium-Medium unconnected")
```

```{r child = here("3_r_files", "analysis_metaeco_connection.Rmd")}
```

#### Biomass {.tabset .tabset-pills}

```{r}
response_variable = "total_metaecosystem_bioarea_mm2"
```

```{r}
metaecosystem_type_i = c("Medium-Medium meta-ecosystem",
                         "Medium-Medium unconnected",
                         "Small-Large meta-ecosystem",
                         "Small-Large unconnected")
```

```{r child = here("3_r_files", "analysis_metaeco_variable_all.Rmd")}
```

<br>

Following the initial inspection, we proceed to analyse differences among meta-ecosystems. To make it easier to interpret differences, we decided to construct a model for each comparisons we are interested in, which are: asymmetric vs symmetric connected, asymmetric connected vs unconnected, and symmetric connected vs unconnected. 

##### Holistic

```{r child = here("3_r_files", "holistic_model_metaecosystems.Rmd"), eval = (disturbance_global_input == "high")}
```

```{r child = here("3_r_files", "holistic_model_metaecosystems_automatic_optimiser.Rmd"), eval = (disturbance_global_input == "low")}
```

##### SL {.tabset .tabset-pills}

```{r}
metaecosystem_type_i = c("Small-Large meta-ecosystem",
                         "Small-Large unconnected")
```

```{r child = here("3_r_files", "analysis_metaeco_connection.Rmd")}
```

##### MM {.tabset .tabset-pills}

```{r}
metaecosystem_type_i = c("Medium-Medium meta-ecosystem",
                         "Medium-Medium unconnected")
```

```{r child = here("3_r_files", "analysis_metaeco_connection.Rmd")}
```

### All ecosystems {.tabset .tabset-pills}

```{r}
ecosystem_type_i = c("Small unconnected",
                     "Medium unconnected",
                     "Large unconnected",
                     "Small connected to small",
                     "Small connected to large",
                     "Medium connected to medium",
                     "Large connected to small",
                     "Large connected to large")
```

#### Shannon

```{r}
response_variable = "shannon"
```

```{r child = here("3_r_files", "holistic_model_ecosystems.Rmd")}
```

#### Biomass

```{r}
response_variable = "bioarea_mm2_per_ml"
```

```{r child = here("3_r_files", "holistic_model_ecosystems.Rmd")}
```

#### BEF {.tabset .tabset-pills}

```{r child = here("3_r_files", "analysis_ecosystems_BEF.Rmd")}
```

#### Evaporation (both disturbance levels)

```{r child = here("3_r_files", "evaporation_both_disturbance_levels_size.Rmd")}
```

#### Species abundances correlation

```{r}
ggpairs(ds_ecosystems %>%select(Ble_indiv_per_ml_dominance:Tet_indiv_per_ml_dominance))
```


### $S$ vs $M$ vs $L$ {.tabset .tabset-pills}

```{r}
ecosystem_type_i = c("Small unconnected",
                     "Medium unconnected",
                     "Large unconnected")
```

#### Shannon {.tabset .tabset-pills}

```{r}
response_variable = "shannon"
```

```{r child = here("3_r_files", "analysis_unconnected_ecosystems_variable.Rmd")}
```

#### Biomass {.tabset .tabset-pills}

```{r}
response_variable = "bioarea_mm2_per_ml"
```

```{r child = here("3_r_files", "analysis_unconnected_ecosystems_variable.Rmd")}
```

#### Richness {.tabset .tabset-pills}

```{r}
response_variable = "species_richness"
```

```{r child = here("3_r_files", "analysis_unconnected_ecosystems_variable.Rmd")}
```

#### Evenness {.tabset .tabset-pills}

```{r}
response_variable = "evenness_pielou"
```

```{r child = here("3_r_files", "analysis_unconnected_ecosystems_variable.Rmd")}
```

#### Median Size {.tabset .tabset-pills}

```{r}
response_variable = "median_body_area_µm2"
```

```{r child = here("3_r_files", "analysis_unconnected_ecosystems_variable.Rmd")}
```

#### Auto/Hetero {.tabset .tabset-pills}

```{r}
response_variable = "auto_hetero_ratio"
```

```{r child = here("3_r_files", "analysis_unconnected_ecosystems_variable.Rmd")}
```

#### Populations

```{r child = here("3_r_files", "analysis_ecosystems_populations.Rmd")}
```

#### Evaporation

```{r}
plot.ecosystems.points(ds_ecosystems,
                       ecosystem_type_i,
                       "water_addition_ml")
```

### $S_{L}$ vs $S$ {.tabset .tabset-pills}

```{r}
ecosystem_type_i = c("Small connected to large",
                     "Small unconnected")
```

#### Shannon {.tabset .tabset-pills}

```{r}
response_variable = "shannon"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Biomass {.tabset .tabset-pills}

```{r}
response_variable = "bioarea_mm2_per_ml"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Richness {.tabset .tabset-pills}

```{r}
response_variable = "species_richness"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Evenness {.tabset .tabset-pills}

```{r}
response_variable = "evenness_pielou"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Median Size {.tabset .tabset-pills}

```{r}
response_variable = "median_body_area_µm2"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Populations

```{r child = here("3_r_files", "analysis_ecosystems_populations.Rmd")}
```

#### Evaporation

```{r}
plot.ecosystems.points(ds_ecosystems,
                       ecosystem_type_i,
                       "water_addition_ml")
```

### $S_{L}$ vs $S_{S}$ {.tabset .tabset-pills}

```{r}
ecosystem_type_i = c("Small connected to large",
                 "Small connected to small")
```

#### Shannon {.tabset .tabset-pills}

```{r}
response_variable = "shannon"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Biomass {.tabset .tabset-pills}

```{r}
response_variable = "bioarea_mm2_per_ml"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Richness {.tabset .tabset-pills}

```{r}
response_variable = "species_richness"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Evenness {.tabset .tabset-pills}

```{r}
response_variable = "evenness_pielou"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Median Size {.tabset .tabset-pills}

```{r}
response_variable = "median_body_area_µm2"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Populations

```{r child = here("3_r_files", "analysis_ecosystems_populations.Rmd")}
```

#### Evaporation

```{r}
plot.ecosystems.points(ds_ecosystems,
                       ecosystem_type_i,
                       "water_addition_ml")
```

### $S_{S}$ vs $S${.tabset .tabset-pills}

```{r}
ecosystem_type_i = c("Small connected to small",
                 "Small unconnected")
```

#### Shannon {.tabset .tabset-pills}

```{r}
response_variable = "shannon"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Biomass {.tabset .tabset-pills}

```{r}
response_variable = "bioarea_mm2_per_ml"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Richness {.tabset .tabset-pills}

```{r}
response_variable = "species_richness"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Evenness {.tabset .tabset-pills}

```{r}
response_variable = "evenness_pielou"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Median Size {.tabset .tabset-pills}

```{r}
response_variable = "median_body_area_µm2"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Populations

```{r child = here("3_r_files", "analysis_ecosystems_populations.Rmd")}
```

#### Evaporation

```{r}
plot.ecosystems.points(ds_ecosystems,
                       ecosystem_type_i,
                       "water_addition_ml")
```

### $L_{S}$ vs $L$ {.tabset .tabset-pills}

```{r}
ecosystem_type_i = c("Large connected to small",
                 "Large unconnected")
```

#### Shannon {.tabset .tabset-pills}

```{r}
response_variable = "shannon"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Biomass {.tabset .tabset-pills}

```{r}
response_variable = "bioarea_mm2_per_ml"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems_special_control.Rmd")}
```

#### Richness {.tabset .tabset-pills}

```{r}
response_variable = "species_richness"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Evenness {.tabset .tabset-pills}

```{r}
response_variable = "evenness_pielou"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Median Size {.tabset .tabset-pills}

```{r}
response_variable = "median_body_area_µm2"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Populations

```{r child = here("3_r_files", "analysis_ecosystems_populations.Rmd")}
```

#### Evaporation

```{r}
plot.ecosystems.points(ds_ecosystems,
                       ecosystem_type_i,
                       "water_addition_ml")
```

### $L_{S}$ vs $L_{L}$ {.tabset .tabset-pills}

```{r}
ecosystem_type_i = c("Large connected to small",
                 "Large connected to large")
```

#### Shannon {.tabset .tabset-pills}

```{r}
response_variable = "shannon"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Biomass {.tabset .tabset-pills}

```{r}
response_variable = "bioarea_mm2_per_ml"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems_special_control.Rmd")}
```

#### Richness {.tabset .tabset-pills}

```{r}
response_variable = "species_richness"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Evenness {.tabset .tabset-pills}

```{r}
response_variable = "evenness_pielou"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Median Size {.tabset .tabset-pills}

```{r}
response_variable = "median_body_area_µm2"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Populations

```{r child = here("3_r_files", "analysis_ecosystems_populations.Rmd")}
```

#### Evaporation

```{r}
plot.ecosystems.points(ds_ecosystems,
                       ecosystem_type_i,
                       "water_addition_ml")
```

### $L_{L}$ vs $L$ {.tabset .tabset-pills}

```{r}
ecosystem_type_i = c("Large connected to large",
                 "Large unconnected")
```

#### Shannon {.tabset .tabset-pills}

```{r}
response_variable = "shannon"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Biomass {.tabset .tabset-pills}

```{r}
response_variable = "bioarea_mm2_per_ml"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Richness {.tabset .tabset-pills}

```{r}
response_variable = "species_richness"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Evenness {.tabset .tabset-pills}

```{r}
response_variable = "evenness_pielou"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Median Size {.tabset .tabset-pills}

```{r}
response_variable = "median_body_area_µm2"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Populations

```{r child = here("3_r_files", "analysis_ecosystems_populations.Rmd")}
```

#### Evaporation

```{r}
plot.ecosystems.points(ds_ecosystems,
                       ecosystem_type_i,
                       "water_addition_ml")
```

### $M_{M}$ vs $M$ {.tabset .tabset-pills}

```{r}
ecosystem_type_i = c("Medium unconnected",
                     "Medium connected to medium")
```

#### Shannon {.tabset .tabset-pills}

```{r}
response_variable = "shannon"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Biomass {.tabset .tabset-pills}

```{r}
response_variable = "bioarea_mm2_per_ml"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Richness {.tabset .tabset-pills}

```{r}
response_variable = "species_richness"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Evenness {.tabset .tabset-pills}

```{r}
response_variable = "evenness_pielou"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Median Size {.tabset .tabset-pills}

```{r}
response_variable = "median_body_area_µm2"
```

```{r child = here("3_r_files", "analysis_small_n_large_ecosystems.Rmd")}
```

#### Populations

```{r child = here("3_r_files", "analysis_ecosystems_populations.Rmd")}
```

#### Evaporation

```{r}
plot.ecosystems.points(ds_ecosystems,
                       ecosystem_type_i,
                       "water_addition_ml")
```

## Results {.tabset .tabset-pills}

### Meta-ecosystem diversity & function

```{r child = here("3_r_files", "paper_metaecosystem_diversity_n_function.Rmd")}
```

```{r child = here("3_r_files", "present_metaecosystem_diversity_n_function.Rmd"), echo = FALSE}
```

### Ecosystem diversity & function

```{r child = here("3_r_files", "paper_ecosystems_S_n_L_diversity_n_function.Rmd")} 
```

```{r child = here("3_r_files", "paper_ecosystems_M_diversity_n_function.Rmd")} 
```

### Ecosystem autotrophic/heterotrophic ratio

```{r child = here("3_r_files", "paper_ecosystem_auto_hetero_ratio.Rmd")}
```

## Evaporation

```{r child = here("3_r_files", "evaporation_model.Rmd"), eval=FALSE}
```

```{r child = here("3_r_files", "evaporation_test.Rmd")}
```

## Analysis scripts {.tabset .tabset-pills}

### Video analysis

```{r child = here("3_r_files", "BEMOVI_script_video_analysis.Rmd"), class.source = "fold-show"}
```

### Species identification

```{r child = here("3_r_files", "BEMOVI_script_species_id.Rmd"), class.source = "fold-show"}
```

## Other

```{r child = here("3_r_files", "other.Rmd")}
```

## References

```{r echo=FALSE, message=FALSE}
save.image(file = here("4_environments", "environment_at_the_end_of_analysis.RData"))
```