---
html_document:
  toc: yes
  toc_float: yes
  code_folding: hide
  number_sections: yes
  includes:
    after_body: "tabset-dropdown.html"
author: "Emanuele Giacomuzzo"
date: "`r format(Sys.time(), '%Y-%m-%d %H:%M')`"
output:
  html_document:
    code_folding: hide
    profiling: yes
bibliography: library.bib
title: "ecosystemSize"
editor_options:
  chunk_output_type: console
---

```{r echo=FALSE}
disturbance_global_selected = "high"
print(paste("!!", 
            disturbance_global_selected, 
            "!!", 
            "The experiment investigate the effects of two disturbance levels: low and high.",
            "To make it easier to interpet, we showcase only one of the two disturbance levels. In this document we showcase only the", 
            disturbance_global_selected, 
            "disturbance)"))
```

```{r child = here::here("3_r_files", "-2_set_packages.Rmd"), echo = FALSE, message = FALSE, cache = FALSE, autodep = FALSE}
```

```{r child = here("3_r_files", "-1_set_functions.Rmd"), echo=FALSE}
```

#  {.tabset}

## Design {.tabset .tabset-pills}

```{r child = here("3_r_files", "0_design.Rmd")}
```

## Parameters

```{r child = here("3_r_files", "1_set_parameters.Rmd"), class.source = 'fold-show'}
```

## Data {.tabset .tabset-dropdown}

```{r child = here("3_r_files", "2_ds_ecosystems_info.Rmd")}
```

```{r child = here("3_r_files", "3_ds_individuals.Rmd")}
```

```{r child = here("3_r_files", "4_ds_ecosystems.Rmd")}
```

```{r child = here("3_r_files", "5_ds_ecosystems_effect_size.Rmd")}
```

```{r child = here("3_r_files", "6_ds_metaecos_1_ecosystem_combinations.Rmd")}
```

```{r child = here("3_r_files", "7_ds_metaecos_2_ecosystem_combination_sets.Rmd")}
```

```{r child = here("3_r_files", "8_ds_metaecos_3_finish.Rmd")}
```

```{r child = here("3_r_files", "9_ds_classes.Rmd"), eval = FALSE}
```

```{r child = here("3_r_files", "10_ds_classes_effect_size.Rmd"), eval = FALSE}
```

```{r child = here("3_r_files", "11_ds_all_filtered.Rmd")}
```

## Plots & Analysis {.tabset .tabset-dropdown}

### All meta-ecosystems {.tabset .tabset-pills}

```{r}
metaecosystem_type_selected = c("Small-Small",
                                "Large-Large",
                                "Medium-Medium",
                                "Small-Large")

connection_selected = c("connected",
                        "unconnected")
```

#### Alpha {.tabset .tabset-pills}

```{r}
response_variable_selected = "mean_shannon"
```

```{r child = here("3_r_files", "12_metaecos_plot_all.Rmd")}
```

#### Beta {.tabset .tabset-pills}

```{r}
response_variable_selected = "bray_curtis"
```

```{r child = here("3_r_files", "12_metaecos_plot_all.Rmd")}
```

#### Gamma {.tabset .tabset-pills}

```{r}
response_variable_selected = "metaecosystem_richness"
```

```{r child = here("3_r_files", "12_metaecos_plot_all.Rmd")}
```

#### Biomass {.tabset .tabset-pills}

```{r}
response_variable_selected = "total_metaecosystem_bioarea_mm2"
```

```{r child = here("3_r_files", "12_metaecos_plot_all.Rmd")}
```

### SL vs MM {.tabset .tabset-pills}

#### Alpha {.tabset .tabset-pills}

```{r}
response_variable_selected = "mean_shannon"
```

```{r}
metaecosystem_type_selected = c("Medium-Medium",
                                "Small-Large")
```

```{r child = here("3_r_files", "12_metaecos_plot_all.Rmd")}
```

<br>

Following the initial inspection, we proceed to analyse differences among meta-ecosystems. To make it easier to interpret differences, we decided to construct a model for each comparisons we are interested in, which are: SL (connected vs unconnected) and MM (connected vs unconnected).

```{r}
comparison_type = "all"
```

```{r child = here("3_r_files", "13_metaecos_stats_holistic.Rmd"), eval = FALSE}
```

##### SL {.tabset .tabset-pills}

```{r}
metaecosystem_type_selected = c("Small-Large")
```

```{r echo=FALSE, message=FALSE}
save.image(file = here("4_environments", "before.RData"))
```

```{r child = here("3_r_files", "15_metaecos_stats_connection.Rmd")}
```

##### MM {.tabset .tabset-pills}

```{r}
metaecosystem_type_selected = c("Medium-Medium")
```

```{r child = here("3_r_files", "15_metaecos_stats_connection.Rmd")}
```

<br>

Following the initial inspection, we proceed to analyse differences among meta-ecosystems. To make it easier to interpret differences, we decided to construct a model for each comparisons we are interested in, which are: SL (connected vs unconnected) and MM (connected vs unconnected). 

#### Beta {.tabset .tabset-pills}

```{r}
response_variable_selected = "bray_curtis"
```

```{r}
metaecosystem_type_selected = c("Medium-Medium",
                                "Small-Large")
```

```{r child = here("3_r_files", "12_metaecos_plot_all.Rmd")}
```

```{r child = here("3_r_files", "13_metaecos_stats_holistic.Rmd"), eval = FALSE}
```

##### SL {.tabset .tabset-pills}

```{r}
metaecosystem_type_selected = c("Small-Large")
```

```{r child = here("3_r_files", "15_metaecos_stats_connection.Rmd")}
```

##### MM {.tabset .tabset-pills}

```{r}
metaecosystem_type_selected = c("Medium-Medium")
```

```{r child = here("3_r_files", "15_metaecos_stats_connection.Rmd")}
```

<br>

Following the initial inspection, we proceed to analyse differences among meta-ecosystems. To make it easier to interpret differences, we decided to construct a model for each comparisons we are interested in, which are: SL (connected vs unconnected) and MM (connected vs unconnected). 

#### Gamma {.tabset .tabset-pills}

```{r}
response_variable_selected = "metaecosystem_richness"
```

```{r}
metaecosystem_type_selected = c("Medium-Medium",
                                "Small-Large")
```

```{r child = here("3_r_files", "12_metaecos_plot_all.Rmd")}
```

```{r child = here("3_r_files", "13_metaecos_stats_holistic.Rmd"), eval = FALSE}
```

##### SL {.tabset .tabset-pills}

```{r}
metaecosystem_type_selected = c("Small-Large")
```

```{r child = here("3_r_files", "15_metaecos_stats_connection.Rmd")}
```

##### MM {.tabset .tabset-pills}

```{r}
metaecosystem_type_selected = c("Medium-Medium")
```

```{r child = here("3_r_files", "15_metaecos_stats_connection.Rmd")}
```

#### Biomass {.tabset .tabset-pills}

```{r}
response_variable_selected = "total_metaecosystem_bioarea_mm2"
```

```{r}
metaecosystem_type_selected = c("Medium-Medium",
                                "Small-Large")
```

```{r child = here("3_r_files", "12_metaecos_plot_all.Rmd")}
```

<br>

Following the initial inspection, we proceed to analyse differences among meta-ecosystems. To make it easier to interpret differences, we decided to construct a model for each comparisons we are interested in, which are: SL (connected vs unconnected) and MM (connected vs unconnected).

```{r child = here("3_r_files", "13_metaecos_stats_holistic.Rmd"), eval = FALSE}
```

##### SL {.tabset .tabset-pills}

```{r}
metaecosystem_type_selected = c("Small-Large")
```

```{r child = here("3_r_files", "15_metaecos_stats_connection.Rmd")}
```

##### MM {.tabset .tabset-pills}

```{r}
metaecosystem_type_selected = c("Medium-Medium")
```

```{r child = here("3_r_files", "15_metaecos_stats_connection.Rmd")}
```

### All ecosystems {.tabset .tabset-pills}

```{r}
ecosystem_type_selected = c("Small unconnected",
                            "Medium unconnected",
                            "Large unconnected",
                            "Small connected to small",
                            "Small connected to large",
                            "Medium connected to medium",
                            "Large connected to small",
                            "Large connected to large")
```

#### BEF {.tabset .tabset-pills}

```{r child = here("3_r_files", "16_ecos_plot_BEF.Rmd")}
```

#### Evaporation (both disturbance levels)

```{r}
response_variable = "water_addition_ml"
```

```{r child = here("3_r_files", "17_ecos_stats_evaporation.Rmd")}
```

### $S$ vs $M$ vs $L$ {.tabset .tabset-pills}

```{r}
ecosystem_type_selected = c("Small unconnected",
                            "Medium unconnected",
                            "Large unconnected")
```

#### Shannon {.tabset .tabset-pills}

```{r}
response_variable_selected = "shannon"
```

```{r child = here("3_r_files", "19_ecos_stats_unconnected.Rmd")}
```

#### Biomass {.tabset .tabset-pills}

```{r}
response_variable_selected = "bioarea_mm2_per_ml"
```

```{r child = here("3_r_files", "19_ecos_stats_unconnected.Rmd")}
```

#### Richness {.tabset .tabset-pills}

```{r}
response_variable_selected = "species_richness"
```

```{r child = here("3_r_files", "19_ecos_stats_unconnected.Rmd")}
```

#### Evenness {.tabset .tabset-pills}

```{r}
response_variable_selected = "evenness_pielou"
```

```{r child = here("3_r_files", "19_ecos_stats_unconnected.Rmd")}
```

#### Median Size {.tabset .tabset-pills}

```{r}
response_variable_selected = "median_body_area_Âµm2"
```

```{r child = here("3_r_files", "19_ecos_stats_unconnected.Rmd")}
```

#### Auto/Hetero {.tabset .tabset-pills}

```{r}
response_variable_selected = "auto_hetero_ratio"
```

```{r child = here("3_r_files", "19_ecos_stats_unconnected.Rmd")}
```

#### Populations

```{r child = here("3_r_files", "20_ecos_plot_populations.Rmd")}
```

#### Evaporation (both disturbance levels)

```{r}
response_variable = "water_addition_ml"
```

```{r child = here("3_r_files", "17_ecos_stats_evaporation.Rmd")}
```

### $S_{L}$ vs $S$ {.tabset .tabset-pills}

```{r}
ecosystem_type_selected = c("Small connected to large",
                            "Small unconnected")
```

#### Shannon {.tabset .tabset-pills}

```{r}
response_variable_selected = "shannon"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Biomass {.tabset .tabset-pills}

```{r}
response_variable_selected = "bioarea_mm2_per_ml"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Richness {.tabset .tabset-pills}

```{r}
response_variable_selected = "species_richness"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Evenness {.tabset .tabset-pills}

```{r}
response_variable_selected = "evenness_pielou"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Median Size {.tabset .tabset-pills}

```{r}
response_variable_selected = "median_body_area_Âµm2"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Populations

```{r child = here("3_r_files", "20_ecos_plot_populations.Rmd")}
```

#### Evaporation

```{r}
plot.ecosystems.points(ds_ecosystems,
                       ecosystem_type_selected,
                       "water_addition_ml")
```

### $S_{L}$ vs $S_{S}$ {.tabset .tabset-pills}

```{r}
ecosystem_type_selected = c("Small connected to large",
                     "Small connected to small")
```

#### Shannon {.tabset .tabset-pills}

```{r}
response_variable_selected = "shannon"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Biomass {.tabset .tabset-pills}

```{r}
response_variable_selected = "bioarea_mm2_per_ml"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Richness {.tabset .tabset-pills}

```{r}
response_variable_selected = "species_richness"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Evenness {.tabset .tabset-pills}

```{r}
response_variable_selected = "evenness_pielou"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Median Size {.tabset .tabset-pills}

```{r}
response_variable_selected = "median_body_area_Âµm2"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Populations

```{r child = here("3_r_files", "20_ecos_plot_populations.Rmd")}
```

#### Evaporation

```{r}
plot.ecosystems.points(ds_ecosystems,
                       ecosystem_type_selected,
                       "water_addition_ml")
```

### $S_{S}$ vs $S${.tabset .tabset-pills}

```{r}
ecosystem_type_selected = c("Small connected to small",
                     "Small unconnected")
```

#### Shannon {.tabset .tabset-pills}

```{r}
response_variable_selected = "shannon"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Biomass {.tabset .tabset-pills}

```{r}
response_variable_selected = "bioarea_mm2_per_ml"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Richness {.tabset .tabset-pills}

```{r}
response_variable_selected = "species_richness"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Evenness {.tabset .tabset-pills}

```{r}
response_variable_selected = "evenness_pielou"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Median Size {.tabset .tabset-pills}

```{r}
response_variable_selected = "median_body_area_Âµm2"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Populations

```{r child = here("3_r_files", "20_ecos_plot_populations.Rmd")}
```

#### Evaporation

```{r}
plot.ecosystems.points(ds_ecosystems,
                       ecosystem_type_selected,
                       "water_addition_ml")
```

### $L_{S}$ vs $L$ {.tabset .tabset-pills}

```{r}
ecosystem_type_selected = c("Large connected to small",
                     "Large unconnected")
```

#### Shannon {.tabset .tabset-pills}

```{r}
response_variable_selected = "shannon"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Biomass {.tabset .tabset-pills}

```{r}
response_variable_selected = "bioarea_mm2_per_ml"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Richness {.tabset .tabset-pills}

```{r}
response_variable_selected = "species_richness"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Evenness {.tabset .tabset-pills}

```{r}
response_variable_selected = "evenness_pielou"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Median Size {.tabset .tabset-pills}

```{r}
response_variable_selected = "median_body_area_Âµm2"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Populations

```{r child = here("3_r_files", "20_ecos_plot_populations.Rmd")}
```

#### Evaporation

```{r}
plot.ecosystems.points(ds_ecosystems,
                       ecosystem_type_selected,
                       "water_addition_ml")
```

### $L_{S}$ vs $L_{L}$ {.tabset .tabset-pills}

```{r}
ecosystem_type_selected = c("Large connected to small",
                 "Large connected to large")
```

#### Shannon {.tabset .tabset-pills}

```{r}
response_variable_selected = "shannon"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Biomass {.tabset .tabset-pills}

```{r}
response_variable_selected = "bioarea_mm2_per_ml"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Richness {.tabset .tabset-pills}

```{r}
response_variable_selected = "species_richness"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Evenness {.tabset .tabset-pills}

```{r}
response_variable_selected = "evenness_pielou"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Median Size {.tabset .tabset-pills}

```{r}
response_variable_selected = "median_body_area_Âµm2"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Populations

```{r child = here("3_r_files", "20_ecos_plot_populations.Rmd")}
```

#### Evaporation

```{r}
plot.ecosystems.points(ds_ecosystems,
                       ecosystem_type_selected,
                       "water_addition_ml")
```

### $L_{L}$ vs $L$ {.tabset .tabset-pills}

```{r}
ecosystem_type_selected = c("Large connected to large",
                 "Large unconnected")
```

#### Shannon {.tabset .tabset-pills}

```{r}
response_variable_selected = "shannon"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Biomass {.tabset .tabset-pills}

```{r}
response_variable_selected = "bioarea_mm2_per_ml"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Richness {.tabset .tabset-pills}

```{r}
response_variable_selected = "species_richness"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Evenness {.tabset .tabset-pills}

```{r}
response_variable_selected = "evenness_pielou"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Median Size {.tabset .tabset-pills}

```{r}
response_variable_selected = "median_body_area_Âµm2"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Populations

```{r child = here("3_r_files", "20_ecos_plot_populations.Rmd")}
```

#### Evaporation

```{r}
plot.ecosystems.points(ds_ecosystems,
                       ecosystem_type_selected,
                       "water_addition_ml")
```

### $M_{M}$ vs $M$ {.tabset .tabset-pills}

```{r}
ecosystem_type_selected = c("Medium unconnected",
                     "Medium connected to medium")
```

#### Shannon {.tabset .tabset-pills}

```{r}
response_variable_selected = "shannon"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Biomass {.tabset .tabset-pills}

```{r}
response_variable_selected = "bioarea_mm2_per_ml"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Richness {.tabset .tabset-pills}

```{r}
response_variable_selected = "species_richness"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Evenness {.tabset .tabset-pills}

```{r}
response_variable_selected = "evenness_pielou"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Median Size {.tabset .tabset-pills}

```{r}
response_variable_selected = "median_body_area_Âµm2"
```

```{r child = here("3_r_files", "21_ecos_stats_S_L.Rmd")}
```

#### Populations

```{r child = here("3_r_files", "20_ecos_plot_populations.Rmd")}
```

#### Evaporation

```{r}
plot.ecosystems.points(ds_ecosystems,
                       ecosystem_type_selected,
                       "water_addition_ml")
```

## Results {.tabset .tabset-pills}

### Meta-ecosystem diversity & function

```{r child = here("3_r_files", "23_paper_metaecos.Rmd")}
```

```{r child = here("3_r_files", "24_present_metaecos.Rmd"), echo = FALSE}
```

### Ecosystem diversity & function

```{r child = here("3_r_files", "25.1_paper_ecos_S_L.Rmd")} 
```

```{r child = here("3_r_files", "25.2_present_ecos_S_L.Rmd"), eval = FALSE} 
```

```{r child = here("3_r_files", "26_paper_ecos_M.Rmd")} 
```

### Ecosystem autotrophic/heterotrophic ratio

```{r child = here("3_r_files", "27_paper_ecos_AH_ratio.Rmd")}
```

## Evaporation

```{r child = here("3_r_files", "28_test_evaporation.Rmd")}
```

## Analysis scripts {.tabset .tabset-pills}

### Video analysis

```{r child = here("3_r_files", "29_script_BEMOVI_video_analysis.Rmd"), class.source = "fold-show"}
```

### Species identification

```{r child = here("3_r_files", "30_script_BEMOVI_species_id.Rmd"), class.source = "fold-show"}
```

## Other

```{r child = here("3_r_files", "31_show_other.Rmd")}
```

## Before submitting

- Take off the holistic models
- Update that you took off the third time point
- Comment code

## References

```{r echo=FALSE, message=FALSE}
save.image(file = here("4_environments", "environment_at_the_end_of_analysis.RData"))
```